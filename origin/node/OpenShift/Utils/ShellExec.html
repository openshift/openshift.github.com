<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: OpenShift::Utils::ShellExec
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OpenShift.html" title="OpenShift (module)">OpenShift</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Utils.html" title="OpenShift::Utils (module)">Utils</a></span></span>
     &raquo; 
    <span class="title">ShellExec</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: OpenShift::Utils::ShellExec
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../ApacheDB.html" title="OpenShift::ApacheDB (class)">ApacheDB</a></span>, <span class='object_link'><a href="../ApplicationContainer.html" title="OpenShift::ApplicationContainer (class)">ApplicationContainer</a></span>, <span class='object_link'><a href="../FrontendHttpServer.html" title="OpenShift::FrontendHttpServer (class)">FrontendHttpServer</a></span>, <span class='object_link'><a href="../FrontendProxyServer.html" title="OpenShift::FrontendProxyServer (class)">FrontendProxyServer</a></span>, <span class='object_link'><a href="../UnixUser.html" title="OpenShift::UnixUser (class)">OpenShift::UnixUser</a></span>, <span class='object_link'><a href="../UnixUserObserver.html" title="OpenShift::UnixUserObserver (class)">OpenShift::UnixUserObserver</a></span>, <span class='object_link'><a href="../V1CartridgeModel.html" title="OpenShift::V1CartridgeModel (class)">V1CartridgeModel</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">origin-server/node/lib/openshift-origin-node/utils/shell_exec.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#kill_process_tree-class_method" title="kill_process_tree (class method)">+ (Object) <strong>kill_process_tree</strong>(pid) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
kill_process_tree 2199 -&gt; fixnum.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_as-class_method" title="run_as (class method)">+ (Object) <strong>run_as</strong>(uid, gid, cmd, pwd = &quot;.&quot;, ignore_err = true, expected_rc = 0, timeout = 3600) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shellCmd-class_method" title="shellCmd (class method)">+ (Object) <strong>shellCmd</strong>(cmd, pwd = &quot;.&quot;, ignore_err = true, expected_rc = 0, timeout = 3600) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Public: Execute shell command.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shellCmd-instance_method" title="#shellCmd (instance method)">- (Object) <strong>shellCmd</strong>(cmd, pwd = &quot;.&quot;, ignore_err = true, expected_rc = 0, timeout = 3600) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="kill_process_tree-class_method">
  
    + (<tt>Object</tt>) <strong>kill_process_tree</strong>(pid) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
kill_process_tree 2199 -&gt; fixnum
</p>
<p>
Given a pid find it and KILL it and all it&#8217;s children
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/utils/shell_exec.rb', line 246</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_kill_process_tree identifier id'>kill_process_tree</span><span class='lparen token'>(</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span>
  <span class='rubyid_ps_results identifier id'>ps_results</span> <span class='assign token'>=</span> <span class='xstring val'>`ps -e -opid,ppid --no-headers`</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span>

  <span class='rubyid_ps_tree identifier id'>ps_tree</span> <span class='assign token'>=</span> <span class='rubyid_Hash constant id'>Hash</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_h identifier id'>h</span><span class='comma token'>,</span> <span class='rubyid_k identifier id'>k</span><span class='bitor op'>|</span> <span class='rubyid_h identifier id'>h</span><span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_k identifier id'>k</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
  <span class='rubyid_ps_results identifier id'>ps_results</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_pair identifier id'>pair</span><span class='bitor op'>|</span>
    <span class='rubyid_p identifier id'>p</span><span class='comma token'>,</span> <span class='rubyid_pp identifier id'>pp</span> <span class='assign token'>=</span> <span class='rubyid_pair identifier id'>pair</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span>
    <span class='rubyid_ps_tree identifier id'>ps_tree</span><span class='lbrack token'>[</span><span class='rubyid_pp identifier id'>pp</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_p identifier id'>p</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span>
  <span class='rbrace token'>}</span>
  <span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_kill identifier id'>kill</span><span class='lparen token'>(</span><span class='string val'>&quot;KILL&quot;</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='lparen token'>(</span><span class='rubyid_ps_tree identifier id'>ps_tree</span><span class='lbrack token'>[</span><span class='rubyid_pid identifier id'>pid</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_as-class_method">
  
    + (<tt>Object</tt>) <strong>run_as</strong>(uid, gid, cmd, pwd = &quot;.&quot;, ignore_err = true, expected_rc = 0, timeout = 3600) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ShellExecutionException.html" title="OpenShift::Utils::ShellExecutionException (class)">OpenShift::Utils::ShellExecutionException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/utils/shell_exec.rb', line 257</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_run_as identifier id'>run_as</span><span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='comma token'>,</span> <span class='rubyid_gid identifier id'>gid</span><span class='comma token'>,</span> <span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_pwd identifier id'>pwd</span> <span class='assign token'>=</span> <span class='string val'>&quot;.&quot;</span><span class='comma token'>,</span> <span class='rubyid_ignore_err identifier id'>ignore_err</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_expected_rc identifier id'>expected_rc</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='integer val'>3600</span><span class='rparen token'>)</span>
  <span class='rubyid_mcs_level identifier id'>mcs_level</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExec constant id'>ShellExec</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='dstring node'>&quot;/usr/bin/oo-get-mcs-level #{uid}&quot;</span><span class='comma token'>,</span> <span class='rubyid_pwd identifier id'>pwd</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='rparen token'>)</span>
  <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExecutionException constant id'>ShellExecutionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
            <span class='dstring node'>&quot;Shell command '#{cmd}' returned an error. rc=#{rc}. output=#{err}&quot;</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span><span class='comma token'>,</span> <span class='rubyid_mcs_level identifier id'>mcs_level</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='integer val'>0</span> <span class='neq op'>!=</span> <span class='rubyid_rc identifier id'>rc</span>

  <span class='rubyid_command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;/usr/bin/runcon -r system_r -t openshift_t -l #{mcs_level.chomp} #{cmd}&quot;</span>
  <span class='rubyid_pid identifier id'>pid</span>     <span class='assign token'>=</span> <span class='rubyid_fork identifier id'>fork</span> <span class='lbrace token'>{</span>
    <span class='rubyid_Process constant id'>Process</span><span class='colon2 op'>::</span><span class='rubyid_GID constant id'>GID</span><span class='dot token'>.</span><span class='rubyid_change_privilege identifier id'>change_privilege</span><span class='lparen token'>(</span><span class='rubyid_gid identifier id'>gid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='rparen token'>)</span>
    <span class='rubyid_Process constant id'>Process</span><span class='colon2 op'>::</span><span class='rubyid_UID constant id'>UID</span><span class='dot token'>.</span><span class='rubyid_change_privilege identifier id'>change_privilege</span><span class='lparen token'>(</span><span class='rubyid_uid identifier id'>uid</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span><span class='rparen token'>)</span>
    <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExec constant id'>ShellExec</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='rubyid_pwd identifier id'>pwd</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='rparen token'>)</span>
    <span class='rubyid_exit identifier id'>exit</span> <span class='rubyid_$? gvar id'>$?</span><span class='dot token'>.</span><span class='rubyid_exitstatus identifier id'>exitstatus</span>
  <span class='rbrace token'>}</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_pid identifier id'>pid</span>
    <span class='rubyid_Process constant id'>Process</span><span class='dot token'>.</span><span class='rubyid_wait identifier id'>wait</span><span class='lparen token'>(</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span>
    <span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_$? gvar id'>$?</span><span class='dot token'>.</span><span class='rubyid_exitstatus identifier id'>exitstatus</span>
    <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_ignore_err identifier id'>ignore_err</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_rc identifier id'>rc</span> <span class='neq op'>!=</span> <span class='rubyid_expected_rc identifier id'>expected_rc</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExecutionException constant id'>ShellExecutionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
                <span class='dstring node'>&quot;Shell command '#{command}' returned an error. rc=#{rc}&quot;</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_rc identifier id'>rc</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExecutionException constant id'>ShellExecutionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
              <span class='dstring node'>&quot;Shell command '#{command}' fork failed in run_as().&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shellCmd-class_method">
  
    + (<tt>Object</tt>) <strong>shellCmd</strong>(cmd, pwd = &quot;.&quot;, ignore_err = true, expected_rc = 0, timeout = 3600) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Public: Execute shell command.
</p>
<p>
iv - A String value for the IV file. cmd - A String value of the command to
run. pwd - A String value of target working directory. ignore_err - A
Boolean value to determine if errors should be ignored. expected_rc - A
Integer value for the expected return code of cmd.
</p>
<p>
Examples
</p>
<pre class="code ruby18"><code class="ruby18">
  OpenShift::Utils::ShellExec.shellCmd('ls /etc/passwd')
  # =&gt; [&quot;/etc/passwd\n&quot;,&quot;&quot;, 0]
</code></pre>
<p>
Returns An Array with [stdout, stderr, return_code]
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/utils/shell_exec.rb', line 198</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_pwd identifier id'>pwd</span> <span class='assign token'>=</span> <span class='string val'>&quot;.&quot;</span><span class='comma token'>,</span> <span class='rubyid_ignore_err identifier id'>ignore_err</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_expected_rc identifier id'>expected_rc</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='integer val'>3600</span><span class='rparen token'>)</span>
  <span class='rubyid_out identifier id'>out</span> <span class='assign token'>=</span> <span class='rubyid_err identifier id'>err</span> <span class='assign token'>=</span> <span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_begin begin kw'>begin</span>
    <span class='comment val'># Using Open4 spawn with cwd isn't thread safe</span>
    <span class='rubyid_m_cmd identifier id'>m_cmd</span>                      <span class='assign token'>=</span> <span class='dstring node'>&quot;cd #{pwd} &amp;&amp; ( #{cmd} )&quot;</span>
    <span class='rubyid_pid identifier id'>pid</span><span class='comma token'>,</span> <span class='rubyid_stdin identifier id'>stdin</span><span class='comma token'>,</span> <span class='rubyid_stdout identifier id'>stdout</span><span class='comma token'>,</span> <span class='rubyid_stderr identifier id'>stderr</span> <span class='assign token'>=</span> <span class='rubyid_Open4 constant id'>Open4</span><span class='dot token'>.</span><span class='rubyid_popen4ext identifier id'>popen4ext</span><span class='lparen token'>(</span><span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_m_cmd identifier id'>m_cmd</span><span class='rparen token'>)</span>
    <span class='rubyid_begin begin kw'>begin</span>
      <span class='rubyid_stdin identifier id'>stdin</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_out identifier id'>out</span>   <span class='assign token'>=</span> <span class='rubyid_err identifier id'>err</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
      <span class='rubyid_fds identifier id'>fds</span>   <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_stdout identifier id'>stdout</span><span class='comma token'>,</span> <span class='rubyid_stderr identifier id'>stderr</span><span class='rbrack token'>]</span>
      <span class='rubyid_buffs identifier id'>buffs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rubyid_stdout identifier id'>stdout</span><span class='dot token'>.</span><span class='rubyid_fileno identifier id'>fileno</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span> <span class='rubyid_stderr identifier id'>stderr</span><span class='dot token'>.</span><span class='rubyid_fileno identifier id'>fileno</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_err identifier id'>err</span><span class='rbrace token'>}</span>
      <span class='rubyid_Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='rubyid_timeout identifier id'>timeout</span><span class='lparen token'>(</span><span class='rubyid_timeout identifier id'>timeout</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
        <span class='rubyid_while while kw'>while</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_fds identifier id'>fds</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
          <span class='rubyid_rs identifier id'>rs</span><span class='comma token'>,</span> <span class='rubyid_ws identifier id'>ws</span><span class='comma token'>,</span> <span class='rubyid_es identifier id'>es</span> <span class='assign token'>=</span> <span class='rubyid_IO constant id'>IO</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span><span class='lparen token'>(</span><span class='rubyid_fds identifier id'>fds</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='rparen token'>)</span>
          <span class='rubyid_rs identifier id'>rs</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_f identifier id'>f</span><span class='bitor op'>|</span>
            <span class='rubyid_begin begin kw'>begin</span>
              <span class='rubyid_buffs identifier id'>buffs</span><span class='lbrack token'>[</span><span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_fileno identifier id'>fileno</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_read_nonblock identifier id'>read_nonblock</span><span class='lparen token'>(</span><span class='integer val'>4096</span><span class='rparen token'>)</span>
            <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_IO constant id'>IO</span><span class='colon2 op'>::</span><span class='rubyid_WaitReadable constant id'>WaitReadable</span><span class='comma token'>,</span> <span class='rubyid_IO constant id'>IO</span><span class='colon2 op'>::</span><span class='rubyid_WaitWritable constant id'>WaitWritable</span> <span class='comment val'># Wait in next select</span>
            <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_EOFError constant id'>EOFError</span>
              <span class='rubyid_fds identifier id'>fds</span><span class='dot token'>.</span><span class='rubyid_delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rubyid_item identifier id'>item</span><span class='bitor op'>|</span> <span class='rubyid_item identifier id'>item</span><span class='dot token'>.</span><span class='rubyid_fileno identifier id'>fileno</span> <span class='eq op'>==</span> <span class='rubyid_f identifier id'>f</span><span class='dot token'>.</span><span class='rubyid_fileno identifier id'>fileno</span> <span class='rbrace token'>}</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span>
      <span class='rubyid_kill_process_tree identifier id'>kill_process_tree</span><span class='lparen token'>(</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ShellExecutionException constant id'>ShellExecutionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
                <span class='dstring node'>&quot;Shell command '#{cmd}'' timed out (timeout is #{timeout})&quot;</span><span class='comma token'>,</span> <span class='integer val'>-1</span><span class='comma token'>,</span> <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span><span class='rparen token'>)</span>
    <span class='rubyid_ensure ensure kw'>ensure</span>
      <span class='rubyid_stdout identifier id'>stdout</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_stderr identifier id'>stderr</span><span class='dot token'>.</span><span class='rubyid_close identifier id'>close</span>
      <span class='rubyid_rc identifier id'>rc</span> <span class='assign token'>=</span> <span class='rubyid_Process constant id'>Process</span><span class='colon2 op'>::</span><span class='rubyid_waitpid2 identifier id'>waitpid2</span><span class='lparen token'>(</span><span class='rubyid_pid identifier id'>pid</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_exitstatus identifier id'>exitstatus</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExecutionException constant id'>ShellExecutionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_message identifier id'>message</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span><span class='comma token'>,</span> <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span>
          <span class='rparen token'>)</span> <span class='rubyid_unless unless_mod kw'>unless</span> <span class='rubyid_ignore_err identifier id'>ignore_err</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_ignore_err identifier id'>ignore_err</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_rc identifier id'>rc</span> <span class='neq op'>!=</span> <span class='rubyid_expected_rc identifier id'>expected_rc</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExecutionException constant id'>ShellExecutionException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span>
              <span class='dstring node'>&quot;Shell command '#{cmd}' returned an error. rc=#{rc}&quot;</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span><span class='comma token'>,</span> <span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_return return kw'>return</span> <span class='lbrack token'>[</span><span class='rubyid_out identifier id'>out</span><span class='comma token'>,</span> <span class='rubyid_err identifier id'>err</span><span class='comma token'>,</span> <span class='rubyid_rc identifier id'>rc</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="shellCmd-instance_method">
  
    - (<tt>Object</tt>) <strong>shellCmd</strong>(cmd, pwd = &quot;.&quot;, ignore_err = true, expected_rc = 0, timeout = 3600) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/node/lib/openshift-origin-node/utils/shell_exec.rb', line 181</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_pwd identifier id'>pwd</span> <span class='assign token'>=</span> <span class='string val'>&quot;.&quot;</span><span class='comma token'>,</span> <span class='rubyid_ignore_err identifier id'>ignore_err</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span><span class='comma token'>,</span> <span class='rubyid_expected_rc identifier id'>expected_rc</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='integer val'>3600</span><span class='rparen token'>)</span>
  <span class='rubyid_OpenShift constant id'>OpenShift</span><span class='colon2 op'>::</span><span class='rubyid_Utils constant id'>Utils</span><span class='colon2 op'>::</span><span class='rubyid_ShellExec constant id'>ShellExec</span><span class='dot token'>.</span><span class='rubyid_shellCmd identifier id'>shellCmd</span><span class='lparen token'>(</span><span class='rubyid_cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='rubyid_pwd identifier id'>pwd</span><span class='comma token'>,</span> <span class='rubyid_ignore_err identifier id'>ignore_err</span><span class='comma token'>,</span> <span class='rubyid_expected_rc identifier id'>expected_rc</span><span class='comma token'>,</span> <span class='rubyid_timeout identifier id'>timeout</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sat Mar  2 18:27:20 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.8.7).
</div>

  </body>
</html>