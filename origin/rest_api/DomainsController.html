<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: DomainsController
  
    &mdash; Documentation by YARD 0.8.5.2
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (D)</a> &raquo;
    
    
    <span class="title">DomainsController</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: DomainsController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'>BaseController</span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'>BaseController</span></li>
          
            <li class="next">DomainsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">origin-server/controller/app/controllers/domains_controller.rb</dd>
  
</dl>
<div class="clear"></div>

<div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (RestReply&lt;RestDomain&gt;) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create a new domain for the user.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete a domain for the user.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (RestReply&lt;Array&lt;RestDomain&gt;&gt;) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retuns list of domains for the current user.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (RestReply&lt;RestDomain&gt;) <strong>show</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retuns domain for the current user that match the given parameters.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (RestReply&lt;RestDomain&gt;) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create a new domain for the user.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-instance_method">
  
    - (<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;</tt>) <strong>create</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Create a new domain for the user
</p>
<p>
URL: /domains
</p>
<p>
Action: POST
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The namespace for the domain
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The new domain
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/controller/app/controllers/domains_controller.rb', line 56</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_create identifier id'>create</span>
  <span class='rubyid_namespace identifier id'>namespace</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
  <span class='rubyid_Rails constant id'>Rails</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;Creating domain with namespace #{namespace}&quot;</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:unprocessable_entity</span><span class='comma token'>,</span> <span class='string val'>&quot;Namespace is required and cannot be blank.&quot;</span><span class='comma token'>,</span>
                      <span class='integer val'>106</span><span class='comma token'>,</span> <span class='string val'>&quot;ADD_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;id&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_namespace identifier id'>namespace</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_namespace identifier id'>namespace</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

  <span class='rubyid_domain identifier id'>domain</span> <span class='assign token'>=</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_namespace identifier id'>namespace</span><span class='colon op'>:</span> <span class='rubyid_namespace identifier id'>namespace</span><span class='comma token'>,</span> <span class='rubyid_owner identifier id'>owner</span><span class='colon op'>:</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_valid? fid id'>valid?</span>
    <span class='rubyid_Rails constant id'>Rails</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_error identifier id'>error</span> <span class='string val'>&quot;Domain is not valid&quot;</span>
    <span class='rubyid_messages identifier id'>messages</span> <span class='assign token'>=</span> <span class='rubyid_get_error_messages identifier id'>get_error_messages</span><span class='lparen token'>(</span><span class='rubyid_domain identifier id'>domain</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>&quot;namespace&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;id&quot;</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:unprocessable_entity</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='string val'>&quot;ADD_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_messages identifier id'>messages</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_canonical_namespace identifier id'>canonical_namespace</span><span class='colon op'>:</span> <span class='rubyid_namespace identifier id'>namespace</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:unprocessable_entity</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Namespace '#{namespace}' is already in use. Please choose another.&quot;</span><span class='comma token'>,</span> <span class='integer val'>103</span><span class='comma token'>,</span> <span class='string val'>&quot;ADD_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;id&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_owner identifier id'>owner</span><span class='colon op'>:</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:conflict</span><span class='comma token'>,</span> <span class='string val'>&quot;There is already a namespace associated with this user&quot;</span><span class='comma token'>,</span> <span class='integer val'>103</span><span class='comma token'>,</span> <span class='string val'>&quot;ADD_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;id&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_@domain_name ivar id'>@domain_name</span> <span class='assign token'>=</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span>
  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_save identifier id'>save</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_exception identifier id'>render_exception</span><span class='lparen token'>(</span><span class='rubyid_e identifier id'>e</span><span class='comma token'>,</span> <span class='string val'>&quot;ADD_DOMAIN&quot;</span><span class='rparen token'>)</span> 
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_render_success identifier id'>render_success</span><span class='lparen token'>(</span><span class='symbol val'>:created</span><span class='comma token'>,</span> <span class='string val'>&quot;domain&quot;</span><span class='comma token'>,</span> <span class='rubyid_get_rest_domain identifier id'>get_rest_domain</span><span class='lparen token'>(</span><span class='rubyid_domain identifier id'>domain</span><span class='comma token'>,</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;ADD_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Created domain with namespace #{namespace}&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Delete a domain for the user. Requires that domain be empty unless
&#8216;force&#8217; parameter is set.
</p>
<p>
URL: /domains/:id
</p>
<p>
Action: DELETE
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>force</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
If true, broker will destroy all application within the domain and then
destroy the domain
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/controller/app/controllers/domains_controller.rb', line 152</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_destroy identifier id'>destroy</span>
  <span class='rubyid_id identifier id'>id</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
  <span class='rubyid_force identifier id'>force</span> <span class='assign token'>=</span> <span class='rubyid_get_bool identifier id'>get_bool</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:force</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  
  <span class='comment val'># validate the domain name using regex to avoid a mongo call, if it is malformed</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_id identifier id'>id</span> <span class='nmatch op'>!~</span> <span class='rubyid_Domain constant id'>Domain</span><span class='colon2 op'>::</span><span class='rubyid_DOMAIN_NAME_COMPATIBILITY_REGEX constant id'>DOMAIN_NAME_COMPATIBILITY_REGEX</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:not_found</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain #{id} not found&quot;</span><span class='comma token'>,</span> <span class='integer val'>127</span><span class='comma token'>,</span> <span class='string val'>&quot;DELETE_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_domain identifier id'>domain</span> <span class='assign token'>=</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_find_by identifier id'>find_by</span><span class='lparen token'>(</span><span class='rubyid_owner identifier id'>owner</span><span class='colon op'>:</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='comma token'>,</span> <span class='rubyid_canonical_namespace identifier id'>canonical_namespace</span><span class='colon op'>:</span> <span class='rubyid_id identifier id'>id</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span><span class='rparen token'>)</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Mongoid constant id'>Mongoid</span><span class='colon2 op'>::</span><span class='rubyid_Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='rubyid_DocumentNotFound constant id'>DocumentNotFound</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:not_found</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain #{id} not found&quot;</span><span class='comma token'>,</span> <span class='integer val'>127</span><span class='comma token'>,</span> <span class='string val'>&quot;DELETE_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_force identifier id'>force</span>
    <span class='rubyid_apps identifier id'>apps</span> <span class='assign token'>=</span> <span class='rubyid_Application constant id'>Application</span><span class='dot token'>.</span><span class='rubyid_with identifier id'>with</span><span class='lparen token'>(</span><span class='rubyid_consistency identifier id'>consistency</span><span class='colon op'>:</span> <span class='symbol val'>:strong</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_domain_id identifier id'>domain_id</span><span class='colon op'>:</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid__id identifier id'>_id</span><span class='rparen token'>)</span>
    <span class='rubyid_while while kw'>while</span> <span class='rubyid_apps identifier id'>apps</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='rubyid_apps identifier id'>apps</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_app identifier id'>app</span><span class='bitor op'>|</span>
        <span class='rubyid_app identifier id'>app</span><span class='dot token'>.</span><span class='rubyid_destroy_app identifier id'>destroy_app</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_apps identifier id'>apps</span> <span class='assign token'>=</span> <span class='rubyid_Application constant id'>Application</span><span class='dot token'>.</span><span class='rubyid_with identifier id'>with</span><span class='lparen token'>(</span><span class='rubyid_consistency identifier id'>consistency</span><span class='colon op'>:</span> <span class='symbol val'>:strong</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_domain_id identifier id'>domain_id</span><span class='colon op'>:</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid__id identifier id'>_id</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_Application constant id'>Application</span><span class='dot token'>.</span><span class='rubyid_with identifier id'>with</span><span class='lparen token'>(</span><span class='rubyid_consistency identifier id'>consistency</span><span class='colon op'>:</span> <span class='symbol val'>:strong</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_domain_id identifier id'>domain_id</span><span class='colon op'>:</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid__id identifier id'>_id</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:bad_request</span><span class='comma token'>,</span> <span class='string val'>&quot;Domain contains applications. Delete applications first or set force to true.&quot;</span><span class='comma token'>,</span> <span class='integer val'>128</span><span class='comma token'>,</span> <span class='string val'>&quot;DELETE_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_@domain_name ivar id'>@domain_name</span> <span class='assign token'>=</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span>
  <span class='rubyid_begin begin kw'>begin</span>
    <span class='comment val'># reload the domain so that MongoId does not see any applications</span>
    <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_with identifier id'>with</span><span class='lparen token'>(</span><span class='rubyid_consistency identifier id'>consistency</span><span class='colon op'>:</span> <span class='symbol val'>:strong</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_reload identifier id'>reload</span>
    <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span>
    <span class='rubyid_render_success identifier id'>render_success</span><span class='lparen token'>(</span><span class='symbol val'>:no_content</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='string val'>&quot;DELETE_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain #{id} deleted.&quot;</span><span class='comma token'>,</span> <span class='rubyid_true true kw'>true</span><span class='rparen token'>)</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_exception identifier id'>render_exception</span><span class='lparen token'>(</span><span class='rubyid_e identifier id'>e</span><span class='comma token'>,</span> <span class='string val'>&quot;DELETE_DOMAIN&quot;</span><span class='rparen token'>)</span> 
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    - (<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;Array&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;&gt;</tt>) <strong>index</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Retuns list of domains for the current user
</p>
<p>
URL: /domains
</p>
<p>
Action: GET
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;Array&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
List of domains
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/controller/app/controllers/domains_controller.rb', line 11</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_index identifier id'>index</span>
  <span class='rubyid_rest_domains identifier id'>rest_domains</span> <span class='assign token'>=</span> <span class='rubyid_Array constant id'>Array</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span>
  <span class='rubyid_Rails constant id'>Rails</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;Getting domains for user #{@cloud_user.login}&quot;</span>
  <span class='rubyid_domains identifier id'>domains</span> <span class='assign token'>=</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_owner identifier id'>owner</span><span class='colon op'>:</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span>
  <span class='rubyid_domains identifier id'>domains</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_domain identifier id'>domain</span><span class='bitor op'>|</span>
    <span class='rubyid_rest_domains identifier id'>rest_domains</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span> <span class='rubyid_get_rest_domain identifier id'>get_rest_domain</span><span class='lparen token'>(</span><span class='rubyid_domain identifier id'>domain</span><span class='comma token'>,</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_render_success identifier id'>render_success</span><span class='lparen token'>(</span><span class='symbol val'>:ok</span><span class='comma token'>,</span> <span class='string val'>&quot;domains&quot;</span><span class='comma token'>,</span> <span class='rubyid_rest_domains identifier id'>rest_domains</span><span class='comma token'>,</span> <span class='string val'>&quot;LIST_DOMAINS&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    - (<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;</tt>) <strong>show</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Retuns domain for the current user that match the given parameters.
</p>
<p>
URL: /domains/:id
</p>
<p>
Action: GET
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The namespace of the domain
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The requested domain
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/controller/app/controllers/domains_controller.rb', line 29</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_show identifier id'>show</span>
  <span class='rubyid_id identifier id'>id</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
  <span class='rubyid_Rails constant id'>Rails</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;Getting domain #{id}&quot;</span>

  <span class='comment val'># validate the domain name using regex to avoid a mongo call, if it is malformed</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_id identifier id'>id</span> <span class='nmatch op'>!~</span> <span class='rubyid_Domain constant id'>Domain</span><span class='colon2 op'>::</span><span class='rubyid_DOMAIN_NAME_COMPATIBILITY_REGEX constant id'>DOMAIN_NAME_COMPATIBILITY_REGEX</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:not_found</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain #{id} not found.&quot;</span><span class='comma token'>,</span> <span class='integer val'>127</span><span class='comma token'>,</span> <span class='string val'>&quot;SHOW_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_domain identifier id'>domain</span> <span class='assign token'>=</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_find_by identifier id'>find_by</span><span class='lparen token'>(</span><span class='rubyid_owner identifier id'>owner</span><span class='colon op'>:</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='comma token'>,</span> <span class='rubyid_canonical_namespace identifier id'>canonical_namespace</span><span class='colon op'>:</span> <span class='rubyid_id identifier id'>id</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span><span class='rparen token'>)</span>
    <span class='rubyid_@domain_name ivar id'>@domain_name</span> <span class='assign token'>=</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_success identifier id'>render_success</span><span class='lparen token'>(</span><span class='symbol val'>:ok</span><span class='comma token'>,</span> <span class='string val'>&quot;domain&quot;</span><span class='comma token'>,</span> <span class='rubyid_get_rest_domain identifier id'>get_rest_domain</span><span class='lparen token'>(</span><span class='rubyid_domain identifier id'>domain</span><span class='comma token'>,</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;SHOW_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Found domain #{id}&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Mongoid constant id'>Mongoid</span><span class='colon2 op'>::</span><span class='rubyid_Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='rubyid_DocumentNotFound constant id'>DocumentNotFound</span>
    <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:not_found</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain #{id} not found.&quot;</span><span class='comma token'>,</span> <span class='integer val'>127</span><span class='comma token'>,</span> <span class='string val'>&quot;SHOW_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    - (<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;</tt>) <strong>update</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Create a new domain for the user
</p>
<p>
URL: /domains/:existing_id
</p>
<p>
Action: PUT
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The new namespace for the domain
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>existing_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The current namespace for the domain
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RestReply.html" title="RestReply (class)">RestReply</a></span>&lt;<span class='object_link'><a href="RestDomain.html" title="RestDomain (class)">RestDomain</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The updated domain
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'origin-server/controller/app/controllers/domains_controller.rb', line 98</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_update identifier id'>update</span>
  <span class='rubyid_id identifier id'>id</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:existing_id</span><span class='rbrack token'>]</span>
  <span class='rubyid_new_namespace identifier id'>new_namespace</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
  
  <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:unprocessable_entity</span><span class='comma token'>,</span> <span class='string val'>&quot;Namespace is required and cannot be blank.&quot;</span><span class='comma token'>,</span>
                      <span class='integer val'>106</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;id&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_new_namespace identifier id'>new_namespace</span> <span class='rubyid_or or kw'>or</span> <span class='rubyid_new_namespace identifier id'>new_namespace</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>

  <span class='comment val'># validate the domain name using regex to avoid a mongo call, if it is malformed</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_id identifier id'>id</span> <span class='nmatch op'>!~</span> <span class='rubyid_Domain constant id'>Domain</span><span class='colon2 op'>::</span><span class='rubyid_DOMAIN_NAME_COMPATIBILITY_REGEX constant id'>DOMAIN_NAME_COMPATIBILITY_REGEX</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:not_found</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain #{id} not found&quot;</span><span class='comma token'>,</span> <span class='integer val'>127</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_domain identifier id'>domain</span> <span class='assign token'>=</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_find_by identifier id'>find_by</span><span class='lparen token'>(</span><span class='rubyid_owner identifier id'>owner</span><span class='colon op'>:</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='comma token'>,</span> <span class='rubyid_canonical_namespace identifier id'>canonical_namespace</span><span class='colon op'>:</span> <span class='rubyid_id identifier id'>id</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span><span class='rparen token'>)</span>
    <span class='rubyid_existing_namespace identifier id'>existing_namespace</span> <span class='assign token'>=</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span>
    <span class='rubyid_@domain_name ivar id'>@domain_name</span> <span class='assign token'>=</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Mongoid constant id'>Mongoid</span><span class='colon2 op'>::</span><span class='rubyid_Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='rubyid_DocumentNotFound constant id'>DocumentNotFound</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:not_found</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Domain '#{id}' not found&quot;</span><span class='comma token'>,</span> <span class='integer val'>127</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_Domain constant id'>Domain</span><span class='dot token'>.</span><span class='rubyid_where identifier id'>where</span><span class='lparen token'>(</span><span class='rubyid_canonical_namespace identifier id'>canonical_namespace</span><span class='colon op'>:</span> <span class='rubyid_new_namespace identifier id'>new_namespace</span><span class='dot token'>.</span><span class='rubyid_downcase identifier id'>downcase</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:unprocessable_entity</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Namespace '#{new_namespace}' is already in use. Please choose another.&quot;</span><span class='comma token'>,</span> <span class='integer val'>103</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;id&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='comment val'># set the new namespace for validation </span>
  <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span> <span class='assign token'>=</span> <span class='rubyid_new_namespace identifier id'>new_namespace</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_valid? fid id'>valid?</span>
    <span class='rubyid_messages identifier id'>messages</span> <span class='assign token'>=</span> <span class='rubyid_get_error_messages identifier id'>get_error_messages</span><span class='lparen token'>(</span><span class='rubyid_domain identifier id'>domain</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>&quot;namespace&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;id&quot;</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_error identifier id'>render_error</span><span class='lparen token'>(</span><span class='symbol val'>:unprocessable_entity</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_nil nil kw'>nil</span><span class='comma token'>,</span> <span class='rubyid_messages identifier id'>messages</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  
  <span class='comment val'>#reset the old namespace for use in update_namespace</span>
  <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span> <span class='assign token'>=</span> <span class='rubyid_existing_namespace identifier id'>existing_namespace</span>
  
  <span class='rubyid_@domain_name ivar id'>@domain_name</span> <span class='assign token'>=</span> <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_namespace identifier id'>namespace</span>
  <span class='rubyid_Rails constant id'>Rails</span><span class='dot token'>.</span><span class='rubyid_logger identifier id'>logger</span><span class='dot token'>.</span><span class='rubyid_debug identifier id'>debug</span> <span class='dstring node'>&quot;Updating domain #{domain.namespace} to #{new_namespace}&quot;</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_update_namespace identifier id'>update_namespace</span><span class='lparen token'>(</span><span class='rubyid_new_namespace identifier id'>new_namespace</span><span class='rparen token'>)</span>
    <span class='rubyid_domain identifier id'>domain</span><span class='dot token'>.</span><span class='rubyid_save identifier id'>save</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_render_exception identifier id'>render_exception</span><span class='lparen token'>(</span><span class='rubyid_e identifier id'>e</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='rparen token'>)</span> 
  <span class='rubyid_end end kw'>end</span>
  
  <span class='rubyid_render_success identifier id'>render_success</span><span class='lparen token'>(</span><span class='symbol val'>:ok</span><span class='comma token'>,</span> <span class='string val'>&quot;domain&quot;</span><span class='comma token'>,</span> <span class='rubyid_get_rest_domain identifier id'>get_rest_domain</span><span class='lparen token'>(</span><span class='rubyid_domain identifier id'>domain</span><span class='comma token'>,</span> <span class='rubyid_@cloud_user ivar id'>@cloud_user</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;UPDATE_DOMAIN&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Updated domain #{id} to #{new_namespace}&quot;</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sat Mar 30 18:26:41 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.8.7).
</div>

  </body>
</html>