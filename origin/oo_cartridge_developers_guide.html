<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Asciidoctor 0.1.3" name="generator">
<meta content="OpenShift Origin Documentation Project &lt;dev@lists.openshift.redhat.com&gt;" name="author">
<title>OpenShift Origin Cartridge Developer&#8217;s Guide</title>
<style>@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.css);

/* Adapted for OpenShift Origin from the 'foundation' style sheet at */
/* https://github.com/asciidoctor/asciidoctor-stylesheet-factory/blob/master/sass/foundation.scss */

/* normalize.css v2.1.1 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address styling not present in IE 8/9. */
[hidden] { display: none; }

/* ========================================================================== Base ========================================================================== */
/** 1. Prevent system color scheme's background color being used in Firefox, IE, and Opera. 2. Prevent system color scheme's text color being used in Firefox, IE, and Opera. 3. Set default font family to sans-serif. 4. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { background: #fff; /* 1 */ color: #000; /* 2 */ font-family: sans-serif; /* 3 */ -ms-text-size-adjust: 100%; /* 4 */ -webkit-text-size-adjust: 100%; /* 4 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

a:focus { outline: none; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .ulist > .title, .olist > .title, .dlist > .title, .qlist > .title, .tableblock > caption { line-height: 1.4; color: #6f6f6f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2ba6cb; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #2795b6; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: bold; font-style: normal; color: #222222; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #6f6f6f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #7f0a0c; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }

blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.4; }

code { font-size: inherit; padding: 0; white-space: nowrap; background-color: inherit; border: 0 solid #dddddd; -webkit-border-radius: 0; border-radius: 0; text-shadow: none; }

kbd.keyseq { color: #555555; }

kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

kbd kbd:first-child { margin-left: 0; }

kbd kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: #090909; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; background-image: url('./images/origin_logo.png'); background-repeat: no-repeat; background-attachment: scroll; background-position: 100% 50px; }
#header > h1 { color: black; font-weight: bold; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; margin-top: 150px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul, #toc > ol { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a, #toc ol.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1, #toc ol.sectlevel0 ol.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul, #toc ol { list-style-type: none; }

#toctitle { color: #6f6f6f; }

@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul, #toc.toc2 > ol { font-size: .95em; }
  #toc.toc2 ul ul, #toc.toc2 ol ol { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1, #toc.toc2 ol.sectlevel0 ol.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; } }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }

#footer-text { color: #dddddd; line-height: 1.44; }

.sect1 { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }

.sect1:last-of-type { border-bottom: 0; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #222222; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #151515; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .ulist > .title, .olist > .title, .dlist > .title, .qlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > .paragraph:last-child > p { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 0; border-radius: 0; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 0; border-radius: 0; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #6f6f6f; margin-top: 0; line-height: 1.6; }
.sidebarblock > .content > .paragraph:last-child p { margin-bottom: 0; }

pre { color: black; font-family: monospace, serif; overflow-x: auto; line-height: 1.4; }

.verseblock { margin-bottom: 1.25em; }

.literalblock, .listingblock { margin-bottom: 1.25em; }
.literalblock > .content > pre, .listingblock > .content > pre { background: #eeeeee; color: black; font-family: monospace, serif; border-width: 1px; border-style: solid; border-color: #cccccc; -webkit-border-radius: 0; border-radius: 0; padding: 0.8em 0.8em 0.6em 0.8em; word-wrap: break-word; line-height: 1.4; }
.literalblock > .content > pre.nowrap, .listingblock > .content > pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content > pre > code, .listingblock > .content > pre > code { font-size: 1em; white-space: inherit; color: black; font-family: monospace, serif; padding: 0; background: none; font-weight: normal; border: none; }
@media only screen { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content > pre, .listingblock > .content > pre { font-size: 0.9em; } }

.listingblock:hover .xml:before { content: "xml"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .html:before { content: "html"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .ruby:before { content: "ruby"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .asciidoc:before { content: "asciidoc"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .java:before { content: "java"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .javascript:before { content: "javascript"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .css:before { content: "css"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }
.listingblock:hover .scss:before { content: "scss"; text-transform: uppercase; float: right; font-size: 0.9em; color: #999; }

.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 0; border-radius: 0; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.halign-top, td.tableblock.halign-top { vertical-align: top; }

th.tableblock.halign-bottom, td.tableblock.halign-bottom { vertical-align: bottom; }

th.tableblock.halign-middle, td.tableblock.halign-middle { vertical-align: middle; }

p.tableblock.header { color: #222222; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist { list-style-type: none; margin-left: 0.625em; }

ol.arabic { list-style-type: decimal; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

td.hdlist1 { vertical-align: top; padding-right: .8em; font-weight: bold; }

.qanda > ol > li > p:first-child { color: #2795b6; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock { margin-bottom: 1.25em; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding: 0.75em 0.375em; margin-bottom: 1.25em; #border-top: 1px solid #dddddd; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #2ba6cb; color: #207c98; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum:empty { display: none; }

pre .comment .conum { left: -20px; }

/* Missing alignment styles */
.halign-left { text-align: left }
.halign-center { text-align: center }
.halign-right { text-align: right }

.valign-top { vertical-align: top }
.valign-middle { vertical-align: middle }
.valign-bottom { vertical-align: bottom }</style>
<link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="article toc2">
<div id="header">
<h1>OpenShift Origin Cartridge Developer&#8217;s Guide</h1>
<span id="author">OpenShift Origin Documentation Project &lt;dev@lists.openshift.redhat.com&gt;</span>
<br>
<span id="revnumber"> 2.0,</span>
<span id="revdate">July 2013</span>
<div class="toc2" id="toc">
<div id="toctitle">Table of Contents</div>
<ol type="none" class="sectlevel1">
<li><a href="#cartridge-directory-structure">1. Cartridge Directory Structure</a></li>
<li><a href="#cartridge-metadata">2. Cartridge Metadata</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#cartridge-short-name">2.1. Cartridge-Short-Name</a></li>
<li><a href="#cartridge-version">2.2. Cartridge-Version</a></li>
<li><a href="#compatible-versions">2.3. Compatible-Versions</a></li>
<li><a href="#cartridge-vendor">2.4. Cartridge-Vendor</a></li>
<li><a href="#version">2.5. Version</a></li>
<li><a href="#versions">2.6. Versions</a></li>
<li><a href="#source-url">2.7. Source-Url</a></li>
<li><a href="#source-md5">2.8. Source-Md5</a></li>
<li><a href="#additional-control-actions">2.9. Additional-Control-Actions</a></li>
<li><a href="#endpoints">2.10. Endpoints</a></li>
</ol>
</li>
<li><a href="#managed-files">3. Managed Files</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#entry-values">3.1. Entry Values</a></li>
<li><a href="#strings">3.2. Strings</a></li>
<li><a href="#allowed-entries">3.3. Allowed Entries</a></li>
</ol>
</li>
<li><a href="#cartridge-locking">4. Cartridge Locking</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#lock-configuration">4.1. Lock Configuration</a></li>
<li><a href="#reserved-directories">4.2. Reserved Directories</a></li>
</ol>
</li>
<li><a href="#template-directories-for-language-cartridges">5. Template Directories for Language Cartridges</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#marker-example-files">5.1. Marker Example Files</a></li>
<li><a href="#application-developer-action-hooks">5.2. Application Developer Action Hooks</a></li>
</ol>
</li>
<li><a href="#exposing-services-tcp-endpoints">6. Exposing Services / TCP Endpoints</a></li>
<li><a href="#cartridge-scripts">7. Cartridge Scripts</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#notes-on-script-execution">7.1. Notes on Script Execution</a></li>
<li><a href="#mandatory-scripts">7.2. Mandatory Scripts</a></li>
<li><a href="#optional-scripts">7.3. Optional Scripts</a></li>
<li><a href="#exit-status-codes">7.4. Exit Status Codes</a></li>
<li><a href="#erb-processing">7.5. ERB Processing</a></li>
<li><a href="#bin-setup">7.6. bin/setup</a></li>
<li><a href="#bin-install">7.7. bin/install</a></li>
<li><a href="#bin-post-install">7.8. bin/post-install</a></li>
<li><a href="#bin-teardown">7.9. bin/teardown</a></li>
<li><a href="#bin-control">7.10. bin/control</a></li>
<li><a href="#messaging-to-openshift-from-cartridge">7.11. Messaging to OpenShift from Cartridge</a></li>
</ol>
</li>
<li><a href="#custom-http-services">8. Custom HTTP Services</a></li>
<li><a href="#environment-variables">9. Environment Variables</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#system-provided-variables-read-only">9.1. System Provided Variables (Read Only)</a></li>
<li><a href="#system-provided-cartridge-variables-read-only">9.2. System Provided Cartridge Variables (Read Only)</a></li>
</ol>
</li>
<li><a href="#cartridge-events">10. Cartridge Events</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#cartridge-event-publishing">10.1. Cartridge Event Publishing</a></li>
<li><a href="#cartridge-event-subscriptions">10.2. Cartridge Event Subscriptions</a></li>
<li><a href="#cartridge-event-example">10.3. Cartridge Event Example</a></li>
</ol>
</li>
<li><a href="#backing-up-and-restoring-your-cartridge">11. Backing Up and Restoring Your Cartridge</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#understanding-openshift-behavior-snapshot">11.1. Understanding OpenShift Behavior: Snapshot</a></li>
<li><a href="#understanding-openshift-behavior-restore">11.2. Understanding OpenShift Behavior: Restore</a></li>
</ol>
</li>
<li><a href="#sample-conf-d-openshift-conf-erb">12. Sample conf.d/openshift.conf.erb</a></li>
<li><a href="#openshift-builds">13. OpenShift Builds</a></li>
<li>
<ol type="none" class="sectlevel2">
<li><a href="#default-build-lifecycle">13.1. Default Build Lifecycle</a></li>
<li><a href="#default-scaling-build-lifecycle">13.2. Default Scaling Build Lifecycle</a></li>
<li><a href="#builder-cartridge-lifecycle">13.3. Builder Cartridge Lifecycle</a></li>
<li><a href="#builder-tips">13.4. Builder Tips</a></li>
</ol>
</li>
</ol>
</div>
</div>
<div id="content"><div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Document Site Navigation</div>
<div class="ulist">

<ul>
<li>
<p><a href="index.html"><strong>Documentation Home</strong></a></p>
</li>
<li>
<p><a href="http://openshift.github.io/"><strong>OpenShift Origin Home</strong></a></p>
</li>
</ul>
</div>

</div>
</div>
<div class="paragraph">
<p>OpenShift cartridges provide the necessary command and control for the functionality of software that is running users' applications. OpenShift currently has many language cartridges (JBoss, PHP, Ruby, Rails, etc.) as well as many DB cartridges (Postgres, Mysql, Mongo, etc.). Before writing your own cartridge, you should search the current list of <a href="https://openshift.redhat.com">Red Hat</a> and <a href="https://www.openshift.com/community">OpenShift Community</a> provided cartridges.</p>
</div>
<div class="paragraph">
<p>Cartridge configuration and setup is convention based, with an emphasis on minimizing external dependencies in your cartridge code.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="cartridge-directory-structure"><a class="anchor" href="#cartridge-directory-structure"></a>1. Cartridge Directory Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is an example structure to which your cartridge is expected to conform when written to disk. Failure to meet these expectations will cause your cartridge to not function when either installed or used on OpenShift. You may have additional directories or files as required to meet the needs of the software you are packaging and the application developers using your cartridge.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>[cartridge name]
 +- bin                        (required) <i class="conum">1</i>
 |  +- setup                   (optional) <i class="conum">2</i>
 |  +- install                 (optional)
 |  +- post-install            (optional)
 |  +- teardown                (optional)
 |  +- control                 (required)
 |- hooks                      (optional)
 |  +- set-db-connection-info  (discretionary) <i class="conum">3</i>
 +- versions                   (discretionary)
 |  +- `software version`
 |  |  +- bin
 |  |     +- ...
 |  |  +- data
 |  |     +- template          (optional)
 |  |        +- .openshift
 |  |        |   +- ...
 |  |        +- ... (directory/file tree)
 |  |     +- template.git       (discretionary)
 |  |        +- ... (git bare repo)
 |  +- ...
 +- env                        (required)
 |  +- *.erb
 +- template                   (optional)
 |  +- ... (directory/file tree)
 +  template.git               (discretionary)
 +  +- ... (bare git repository)
 +- usr                        (optional)
 |  +- ...
 +- metadata                   (required)
 |  +- manifest.yml            (required)
 |  +- managed_files.yml       (optional)
 +- conf.d                     (discretionary)
 |  +- openshift.conf.erb
 +- conf                       (discretionary)
 |  +- magic</pre>
</div>
</div>
<div class="colist arabic">

<table>
<tr>
<td><i class="conum">1</i></td>
<td><code>required</code> items must exist for minimal OpenShift support of your cartridge</td>
</tr>
<tr>
<td><i class="conum">2</i></td>
<td><code>optional</code> exist to support additional functionality</td>
</tr>
<tr>
<td><i class="conum">3</i></td>
<td><code>discretionary</code> should be considered best practices for your cartridge and work. E.g., <code>conf.d</code> is the usual name for where a web framework would install its <code>httpd</code> configuration.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To support multiple software versions within one cartridge, you may create symlinks between the <code>bin/control</code> and the <code>versions/{software version}/bin/control</code> file. Or, you may choose to
use the <code>bin/control</code> file as a shim to call the correct versioned <code>control</code> file.</p>
</div>
<div class="paragraph">
<p>When creating an instance of your cartridge for use by a gear, OpenShift will copy the files, links, and directories from the cartridge library with the exclusion of the <code>usr</code> directory. The <code>usr</code> directory will be symlinked into the gear&#8217;s cartridge instance. This allows for the sharing of libraries and other data across all cartridge instances.</p>
</div>
<div class="paragraph">
<p>Later (see Cartridge Locking) we&#8217;ll describe how, as the cartridge author, you can customize a cartridge instance.</p>
</div>

</div>
</div>
<div class="sect1">
<h2 id="cartridge-metadata"><a class="anchor" href="#cartridge-metadata"></a>2. Cartridge Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>manifest.yml</code> file is used by OpenShift to determine what features your cartridge requires and in turn publishes. OpenShift also uses fields in the <code>manifest.yml</code> to determine what data to present to the cartridge user about your cartridge.</p>
</div>
<div class="paragraph">
<p>An example <code>manifest.yml</code> file:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">PHP</span></span>
<span style="color:#606">Cartridge-Short-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">PHP</span></span>
<span style="color:#606">Cartridge-Version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'1.0.1'</span></span>
<span style="color:#606">Compatible-Versions</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">['1.0.1']</span></span>
<span style="color:#606">Cartridge-Vendor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redhat</span></span>
<span style="color:#606">Display-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">PHP 5.3</span></span>
<span style="color:#606">Description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PHP is a general-purpose server-side scripting language...</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">Version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'5.3'</span></span>
<span style="color:#606">Versions</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">['5.3']</span></span>
<span style="color:#606">License</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">The PHP License, version 3.0</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">License-Url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">http://www.php.net/license/3_0.txt</span></span>
<span style="color:#606">Vendor</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">PHP Group</span></span>
<span style="color:#606">Categories</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">service</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">php</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">web_framework</span></span>
<span style="color:#606">Website</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">http://www.php.net</span></span>
<span style="color:#606">Help-Topics</span>:
  <span style="color:#606"><span style="color:#404">&quot;</span><span>Developer Center</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://openshift.redhat.com/community/developers</span></span>
<span style="color:#606">Cart-Data</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Key: OPENSHIFT_...</span></span>
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">environment</span></span>
    <span style="color:#606">Description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">How environment variable should be used</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">Provides</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">php-5.3</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">php</span><span style="color:#710">&quot;</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">php(version) = 5.3.2</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">Publishes</span>:
  <span style="color:#606">get-php-ini</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">FILESYSTEM:php-ini</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">publish-http-url</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NET_TCP:httpd-proxy-info</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">publish-gear-endpoint</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NET_TCP:gear-endpoint-info</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">Subscribes</span>:
  <span style="color:#606">set-db-connection-info</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NET_TCP:db:connection-info</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">Required</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
  <span style="color:#606">set-nosql-db-connection-info</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NET_TCP:nosqldb:connection-info</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">Required</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
  <span style="color:#606">set-mysql-connection-info</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NET_TCP:db:mysql</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">Required</span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
  <span style="color:#606">set-postgres-connection-info</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NET_TCP:db:postgres</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">Required</span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
  <span style="color:#606">set-doc-url</span>:
    <span style="color:#606">Type</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">STRING:urlpath</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">Required</span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
<span style="color:#606">Scaling</span>:
  <span style="color:#606">Min</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
  <span style="color:#606">Max</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">-1</span></span>
<span style="color:#606">Group-Overrides</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">components:</span></span>
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">php-5.3</span></span>
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">web_proxy</span></span>
<span style="color:#606">Endpoints</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Private-IP-Name:   IP1</span></span>
    <span style="color:#606">Private-Port-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">HTTP_PORT</span></span>
    <span style="color:#606">Private-Port</span>:      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">8080</span></span>
    <span style="color:#606">Public-Port-Name</span>:  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">PROXY_HTTP_PORT</span></span>
    <span style="color:#606">Mappings</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Frontend:      &quot;/front&quot;</span></span>
        <span style="color:#606">Backend</span>:       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/back</span><span style="color:#710">&quot;</span></span>
<span style="color:#606">Additional-Control-Actions</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">threaddump</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="cartridge-short-name"><a class="anchor" href="#cartridge-short-name"></a>2.1. Cartridge-Short-Name</h3>
<div class="paragraph">
<p>OpenShift creates a number of environment variables for you when installing your cartridge. This shortened name is used when creating those variables. For example, using the example manifest, the following environment variables would be created:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>OPENSHIFT_PHP_DIR
OPENSHIFT_PHP_IP
OPENSHIFT_PHP_PORT
OPENSHIFT_PHP_PROXY_PORT</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="cartridge-version"><a class="anchor" href="#cartridge-version"></a>2.2. Cartridge-Version</h3>
<div class="paragraph">
<p>The <code>Cartridge-Version</code> element is a version number identifying a release of your cartridge to OpenShift. The value follows the format:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>&lt;number&gt;[.&lt;number&gt;[.&lt;number&gt;[...]]]</pre>
</div>
</div>
<div class="paragraph">
<p>When you publish new versions of your cartridge to OpenShift, this number will be used to determine what is necessary to upgrade the application developer&#8217;s application. YAML will assume number.number is a float; be sure to enclose it in quotes so it is read as a string.</p>
</div>

</div>
<div class="sect2">
<h3 id="compatible-versions"><a class="anchor" href="#compatible-versions"></a>2.3. Compatible-Versions</h3>
<div class="paragraph">
<p><code>Compatible-Versions</code> is a list of past cartridge versions that are <strong>compatible</strong> with this version. To be <strong>compatible</strong> with a previous version, the code changes you made in this version do not require the cartridge to be restarted or the application developer&#8217;s application to be restarted.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>Compatible-Versions: ['1.0.1']</pre>
</div>
</div>
<div class="paragraph">
<p>By not requiring a restart, you improve the application user&#8217;s experience since no downtime will be incurred from your changes. If the cartridge&#8217;s current version is not in the list when upgraded, the cartridge will be stopped, the new code will be installed, <code>setup</code> will be run, and the cartridge started.</p>
</div>
<div class="paragraph">
<p>Today this is a simple list and string matching is used to determine compatible versions. If this list proves to be unmanageable, future versions of OpenShift may implement maven dependency range style checking.</p>
</div>

</div>
<div class="sect2">
<h3 id="cartridge-vendor"><a class="anchor" href="#cartridge-vendor"></a>2.4. Cartridge-Vendor</h3>
<div class="paragraph">
<p>The <code>Cartridge-Vendor</code> element is used to differentiate cartridges when installed in the system. As an individual, you should use the same unique value for all your cartridges to identify yourself; otherwise, use your company name.</p>
</div>

</div>
<div class="sect2">
<h3 id="version"><a class="anchor" href="#version"></a>2.5. Version</h3>
<div class="paragraph">
<p>The <code>Version</code> element is the default or only version of the software packaged by this cartridge.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>Version: '5.3'</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="versions"><a class="anchor" href="#versions"></a>2.6. Versions</h3>
<div class="paragraph">
<p><code>Versions</code> is the list of the versions of the software packaged by this cartridge.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>Versions: ['5.3']</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="source-url"><a class="anchor" href="#source-url"></a>2.7. Source-Url</h3>
<div class="paragraph">
<p><code>Source-Url</code> is used when you self-distribute your cartridges. They are downloaded at the time the application is created.</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<caption class="title">Table 1. non-Git URL support</caption>
<colgroup>
<col>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scheme</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Expected Inputs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">https</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extensions zip, tar, tag.gz, tgz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extensions zip, tar, tag.gz, tgz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file copy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cartridge directory tree expected</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All Git schemes are supported. The cartridge source will be cloned from
the given repository.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>Source-Url: https://github.com/example/killer-cartridge.git
Source-Url: git://github.com/chrisk/fakeweb.git
Source-Url: https://www.example.com/killer-cartridge.zip
Source-Url: https://github.com/example/killer-cartridge/archive/master.zip</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="source-md5"><a class="anchor" href="#source-md5"></a>2.8. Source-Md5</h3>
<div class="paragraph">
<p>If <code>Source-Md5</code> is provided and a non-Git scheme is used for downloading your cartridge, OpenShift will verify the downloaded file against this MD5 digest.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>Source-Md5: 835ed97b00a61f0dae2e2b7a75c672db</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="additional-control-actions"><a class="anchor" href="#additional-control-actions"></a>2.9. Additional-Control-Actions</h3>
<div class="paragraph">
<p>The <code>Additional-Control-Actions</code> element is a list of optional actions supported by your cartridge. <code>threaddump</code> is an example of one such action. OpenShift will only call optional actions if they are included in this element. Supported optional actions:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>threaddump</pre>
</div>
</div>

</div>
<div class="sect2">
<h3 id="endpoints"><a class="anchor" href="#endpoints"></a>2.10. Endpoints</h3>
<div class="paragraph">
<p>See below.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="managed-files"><a class="anchor" href="#managed-files"></a>3. Managed Files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>metadata/managed_files.yml</code> file provides an array of files or strings that are managed or used during different stages of your cartridge lifecycle. The keys for the entries (such as <code>locked_files</code>) can be specified as either strings or Ruby symbols. For example:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">locked_files</span>:
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">env/</span></span>
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">~/.foorc</span></span>
<span style="color:#606">snapshot_exclusions</span>:
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mydir/*</span></span>
<span style="color:#606">restore_transforms</span>:
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">s|${OPENSHIFT_GEAR_NAME}/data|app-root/data|</span></span>
<span style="color:#606">process_templates</span>:
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'**/*.erb'</span></span>
<span style="color:#606">setup_rewritten</span>:
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">conf/*</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="entry-values"><a class="anchor" href="#entry-values"></a>3.1. Entry Values</h3>
<div class="paragraph">
<p>Most entries will use file patterns. These patterns are treated like <a href="http://ruby-doc.org/core-1.9.3/Dir.html#method-c-glob">Shell globs</a>. Any entry that contains one or more <code>*</code> will be processed by <code>Dir.glob</code> (with the <code>File::FNM_DOTMATCH</code> flag). Any entry that ends in a <code>/</code> is treated as a directory; otherwise it will be treated as a single file.</p>
</div>
<div class="paragraph">
<p>Any lines starting with <code>~/</code> will be anchored at the gear directory; otherwise, they will be anchored to your cartridge directory.</p>
</div>

</div>
<div class="sect2">
<h3 id="strings"><a class="anchor" href="#strings"></a>3.2. Strings</h3>
<div class="paragraph">
<p>Some entries allow for string values in the arrays. In this case, the values will be directly returned without any modification.</p>
</div>

</div>
<div class="sect2">
<h3 id="allowed-entries"><a class="anchor" href="#allowed-entries"></a>3.3. Allowed Entries</h3>
<div class="paragraph">
<p>Currently, the following entries are supported:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<caption class="title">Table 2. Supported entries</caption>
<colgroup>
<col>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entry</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locked_files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File Pattern</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#cartridge-locking">Cartridge Locking</a></p>
</div>


</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">snapshot_exclusions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File Pattern</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#backing-up-and-restoring-your-cartridge">Backing up and Restoring your Cartridge</a></p>
</div>


</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">restore_transforms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#backing-up-and-restoring-your-cartridge">Backing up and Restoring your Cartridge</a></p>
</div>


</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">setup_rewritten</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File Pattern</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#binsetup">bin/setup</a></p>
</div>


</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process_templates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File Pattern</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><a href="#erb-processing">ERB Processing</a></p>
</div>


</div></td>
</tr>
</tbody>
</table>

</div>

</div>
</div>
<div class="sect1">
<h2 id="cartridge-locking"><a class="anchor" href="#cartridge-locking"></a>4. Cartridge Locking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cartridge instances within a gear will be either <code>locked</code> or <code>unlocked</code> at any given time. Locking a cartridge allows the cartridge scripts to have additional access to the gear&#8217;s files and directories. Other scripts and hooks written by the application developer will not be able to override decisions you make as the cartridge author.</p>
</div>
<div class="paragraph">
<p>The lock state is controlled by OpenShift. Cartridges are locked and unlocked at various points in the cartridge lifecycle.</p>
</div>
<div class="paragraph">
<p>If you fail to provide a <code>locked_files</code> entry in <code>metadata/managed_files.yml</code> or the file is empty, your cartridge will remain always unlocked. For very simple cartridges, this may be
sufficient.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">

Cartridge file locking is not intended to be a security measure. It is a mechanism to help prevent application developers from inadvertently breaking their application by modifying files reserved for use by you, the cartridge author.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="lock-configuration"><a class="anchor" href="#lock-configuration"></a>4.1. Lock Configuration</h3>
<div class="paragraph">
<p>The <code>metadata/managed_files.yml</code> <code>locked_files</code> entry lists the files and directories, one per line, that will be provided to the cartridge author with read/write access while the cartridge is unlocked, but only read access to the application developer while the cartridge is locked.</p>
</div>
<div class="paragraph">
<p>Any non-existent files that are included in the list will be created before your <code>setup</code> script is called. Any missing parent directories will be created as needed. The list is anchored at the cartridge&#8217;s directory. An entry ending in slash is processed as a directory. Entries ending in asterisk are a list of files. Entries ending in any other character are considered files. OpenShift will not attempt to change files to directories or vice versa, and your cartridge may fail to operate if files are miscategorized and you depend on OpenShift to create them.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Lock Configuration Example</div>
<div class="content">
<div class="paragraph">
<p>Here is a <code>locked_files</code> entry for a PHP cartridge:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">locked_files</span>:
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">~/.pearrc <i class="conum">1</i></span></span>
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">bin/ <i class="conum">2</i></span></span>
- <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">conf/* <i class="conum">3</i></span></span></code></pre>
</div>
</div>
<div class="colist arabic">

<table>
<tr>
<td><i class="conum">1</i></td>
<td>The file <code>~/.pearrc</code> will be created, if it does not exist, and be made editable by you.</td>
</tr>
<tr>
<td><i class="conum">2</i></td>
<td>The directory <code>php/bin</code> is locked but not the files it contains. While you can add files, both you and the application developer can edit any files contained.</td>
</tr>
<tr>
<td><i class="conum">3</i></td>
<td>The files in <code>php/conf</code> are locked but the directory itself is not, so you or the application developer can add files, but only you can edit them.</td>
</tr>
</table>
</div>

</div>
</div>
<div class="paragraph">
<p>Directories like <code>~/.node-gyp</code> and <code>~/.npm</code> in nodejs are <strong>NOT</strong>
candidates to be created in this manner as they require the application
developer to have read and write access while the application is
deploying and running. These directories would need to be created by the
nodejs <code>setup</code> or <code>install</code> scripts.</p>
</div>

</div>
<div class="sect2">
<h3 id="reserved-directories"><a class="anchor" href="#reserved-directories"></a>4.2. Reserved Directories</h3>
<div class="paragraph">
<p>The following list is reserved by OpenShift in the gear&#8217;s home directory:</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>~/.ssh</code></p>
</li>
<li>
<p><code>~/.sandbox</code></p>
</li>
<li>
<p><code>~/.tmp</code></p>
</li>
<li>
<p><code>~/.env</code></p>
</li>
<li>
<p>any non-hidden directory or file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may create any hidden file or directory (one that starts with a period) not in the reserved list in the gear&#8217;s home directory while the cartridge is unlocked.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="template-directories-for-language-cartridges"><a class="anchor" href="#template-directories-for-language-cartridges"></a>5. Template Directories for Language Cartridges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>template</code> or <code>template.git</code> directory should provide an minimal example of an application written in the language/framework your cartridge is packaging. Your application should welcome the application developer to your cartridge and let them see that your cartridge has indeed been installed and operates. If you provide a <code>template</code> directory, OpenShift will transform it into a bare git repository for use by the application developer. If you provide a <code>template.git</code> directory, OpenShift will copy the directory for use by the application
developer.</p>
</div>
<div class="paragraph">
<p>Your <code>setup</code> and <code>install</code> scripts should assume that <code>template</code> directories may be converted to <code>template.git</code> during the packaging of your cartridge for use by OpenShift. The PaaS operator may choose to convert all <code>template</code> directories to bare git repositories <code>template.git</code> to obtain the performance gain when adding your cartridge to a gear. One good workflow point to make this change is when your cartridge is packaged into an RPM.</p>
</div>
<div class="paragraph">
<p>A <code>ruby 1.8</code> with <code>Passenger</code> support would have a <code>public</code> sub-directory and a <code>config.ru</code> file to define the web application.</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>+- template
|  +- config.ru
|  +- public
|  |  +- .gitignore
|  .openshift
|  +- markers
|  |- ...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

A <code>.gitignore</code> file should be placed in empty directories to ensure they survive when the file tree is loaded into a git repository.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="marker-example-files"><a class="anchor" href="#marker-example-files"></a>5.1. Marker Example Files</h3>
<div class="paragraph">
<p>The sub-directory <code>.openshift/markers</code> may contain example files for the application developer. These files denote behavior you are expected to honor in your cartridge&#8217;s lifecycle. Current examples from a Ruby 1.8 cartridge include:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<caption class="title">Table 3. Marker File Descriptions</caption>
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Marker</th>
<th class="tableblock halign-left valign-top">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">force_clean_build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previous output from <code>bundle install --deployment</code> will be removed and all gems will be reinstalled according to the current Gemfile/Gemfile.lock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hot_deploy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will prevent the apache process from being restarted during build/deployment. Note that mod_passenger will respawn the Rack worker processes if any code has been modified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable_auto_scaling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will prevent scalable applications from scaling up or down according to application load.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You may add additional markers to allow an application developer to control aspects of your cartridge.</p>
</div>

</div>
<div class="sect2">
<h3 id="application-developer-action-hooks"><a class="anchor" href="#application-developer-action-hooks"></a>5.2. Application Developer Action Hooks</h3>
<div class="paragraph">
<p>The sub-directory <code>.openshift/action_hooks</code> will contain code the application developer wishes to be run during lifecycle changes. Examples would be:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>pre_start_`cartridge name`
post_start_`cartridge name`
pre_stop_`cartridge name`
...</pre>
</div>
</div>
<div class="paragraph">
<p>As a cartridge author you do not need to execute the default <code>action_hooks</code>. OpenShift will call them during lifecycle changes based on the actions given to the <code>control</code> script. If you wish to add additional hooks, you are expected to document them and you will need to run them explicitly in your <code>control</code> script.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="exposing-services-tcp-endpoints"><a class="anchor" href="#exposing-services-tcp-endpoints"></a>6. Exposing Services / TCP Endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most cartridges provide a service by binding to one or many ports. Cartridges must explicitly declare which ports they will bind to, and provide meaningful variable names to describe the following:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>Any IP addresses necessary for binding</p>
</li>
<li>
<p>The gear-local ports to which the cartridge services will bind</p>
</li>
<li>
<p>(Optional) Publicly proxied ports which expose gear-local ports for use by the application&#8217;s users or intra-gear. These endpoint ports are only created when the application is scalable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to IP and port definitions, Endpoints are where front-end httpd mappings for your cartridge are declared to route traffic from the outside world to your cartridge&#8217;s services.</p>
</div>
<div class="paragraph">
<p>These declarations represent Endpoints, and are defined in the cartridge <code>manifest.yml</code> in the <code>Endpoints</code> section using the following format:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Endpoints</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Private-IP-Name:   &lt;name of IP variable&gt;</span></span>
    <span style="color:#606">Private-Port-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;name of port variable&gt;</span></span>
    <span style="color:#606">Private-Port</span>:      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;port number&gt;</span></span>
    <span style="color:#606">Public-Port-Name</span>:  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;name of public port variable&gt;</span></span>
    <span style="color:#606">Mappings</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Frontend:      &quot;&lt;frontend path&gt;&quot;</span></span>
        <span style="color:#606">Backend</span>:       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;backend path&gt;</span><span style="color:#710">&quot;</span></span>
        <span style="color:#606">Options</span>:       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{ ... }</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;...&gt;</span></span>
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;...&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>During cartridge installation within a gear, IP addresses will be automatically allocated and assigned to each distinct IP variable name, with the guarantee that the specified port will be bindable on the allocated address.</p>
</div>
<div class="paragraph">
<p>If an endpoint specifies a public port variable, a public port proxy mapping will be created using a random external port accessible via the gear&#8217;s DNS entry.</p>
</div>
<div class="paragraph">
<p>Each portion of the Endpoint definition becomes available via environment variables located within the gear and accessible to cartridge scripts and application code. The names of these variables are prefixed with OpenShift namespacing information in the follow the format:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>OPENSHIFT_{Cartridge-Short-Name}_{name of IP variable} <i class="conum">1</i>
OPENSHIFT_{Cartridge-Short-Name}_{name of port variable} <i class="conum">2</i>
OPENSHIFT_{Cartridge-Short-Name}_{name of public port variable} <i class="conum">3</i></pre>
</div>
</div>
<div class="colist arabic">

<table>
<tr>
<td><i class="conum">1</i></td>
<td>Assigned internal IP</td>
</tr>
<tr>
<td><i class="conum">2</i></td>
<td>Endpoint-specified port</td>
</tr>
<tr>
<td><i class="conum">3</i></td>
<td>Assigned external port</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Cartridge-Short-Name</code> is the <a href="#cartridge-short-name">Cartridge-Short-Name</a> element from the cartridge manifest file.</p>
</div>
<div class="paragraph">
<p>If an Endpoint specifies a <code>Mappings</code> section, each mapping entry will be used to create a frontend httpd route to your cartridge using the provided options. The <code>Frontend</code> key represents a frontend path element to be connected to a backend URI specified by the <code>Backend</code> key. The optional <code>Options</code> hash for a mapping allows the route to be configured in a variety of ways:</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>websocket</code> - Enable web sockets on a particular path</p>
</li>
<li>
<p><code>gone</code> - Mark the path as gone (uri is ignored)</p>
</li>
<li>
<p><code>forbidden</code> - Mark the path as forbidden (uri is ignored)</p>
</li>
<li>
<p><code>noproxy</code> - Mark the path as not proxied (uri is ignored)</p>
</li>
<li>
<p><code>redirect</code> - Use redirection to uri instead of proxy (uri must be a path)</p>
</li>
<li>
<p><code>file</code> - Ignore request and load file path contained in uri (must be path)</p>
</li>
<li>
<p><code>tohttps</code> - Redirect request to https and use the path contained in the uri (must be path)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While more than one option is allowed, the above options conflict with each other.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. "CustomCart" Endpoint Configuration</div>
<div class="content">
<div class="paragraph">
<p>Given a cartridge named <code>CustomCart</code> and the following entry in <code>manifest.yml</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">CustomCart</span></span>
<span style="color:#606">Cartridge-Short-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">CUSTOMCART</span></span>
<span style="color:#777"># ...</span>
<span style="color:#606">Endpoints</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Private-IP-Name:   HTTP_IP</span></span>
    <span style="color:#606">Private-Port-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">WEB_PORT</span></span>
    <span style="color:#606">Private-Port</span>:      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">8080</span></span>
    <span style="color:#606">Public-Port-Name</span>:  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">WEB_PROXY_PORT</span></span>
    <span style="color:#606">Mappings</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Frontend:      &quot;/web_front&quot;</span></span>
        <span style="color:#606">Backend</span>:       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/web_back</span><span style="color:#710">&quot;</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Frontend:      &quot;/socket_front&quot;</span></span>
        <span style="color:#606">Backend</span>:       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/socket_back</span><span style="color:#710">&quot;</span></span>
        <span style="color:#606">Options</span>:       <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{ &quot;websocket&quot;: true }</span></span>

  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Private-IP-Name:   HTTP_IP</span></span>
    <span style="color:#606">Private-Port-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ADMIN_PORT</span></span>
    <span style="color:#606">Private-Port</span>:      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">9000</span></span>
    <span style="color:#606">Public-Port-Name</span>:  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ADMIN_PROXY_PORT</span></span>
    <span style="color:#606">Mappings</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Frontend:      &quot;/admin_front&quot;</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Backend:       &quot;/admin_back&quot;</span></span>

  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">Private-IP-Name:   INTERNAL_SERVICE_IP</span></span>
    <span style="color:#606">Private-Port-Name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5544</span></span>
    <span style="color:#606">Public-Port-Name</span>:  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">INTERNAL_SERVICE_PORT</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following environment variables will be generated:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre># Internal IP/port allocations
OPENSHIFT_CUSTOMCART_HTTP_IP=&lt;assigned internal IP 1&gt;
OPENSHIFT_CUSTOMCART_WEB_PORT=8080
OPENSHIFT_CUSTOMCART_ADMIN_PORT=9000
OPENSHIFT_CUSTOMCART_INTERNAL_SERVICE_IP=&lt;assigned internal IP 2&gt;
OPENSHIFT_CUSTOMCART_INTERNAL_SERVICE_PORT=5544

# Public proxy port mappings
OPENSHIFT_CUSTOMCART_WEB_PROXY_PORT=&lt;assigned public port 1&gt;
OPENSHIFT_CUSTOMCART_ADMIN_PROXY_PORT=&lt;assigned public port 2&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the public proxy port mappings are as follows:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>&lt;assigned external IP&gt;:&lt;assigned public port 1&gt; =&gt; OPENSHIFT_CUSTOMCART_HTTP_IP:OPENSHIFT_CUSTOMCART_WEB_PORT
&lt;assigned external IP&gt;:&lt;assigned public port 2&gt; =&gt; OPENSHIFT_CUSTOMCART_HTTP_IP:OPENSHIFT_CUSTOMCART_ADMIN_PORT</pre>
</div>
</div>
<div class="paragraph">
<p>And finally, the following frontend httpd routes will be created:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>http://&lt;app dns&gt;/web_front    =&gt; http://OPENSHIFT_CUSTOMCART_HTTP_IP:8080/web_back
http://&lt;app dns&gt;/socket_front =&gt; http://OPENSHIFT_CUSTOMCART_HTTP_IP:8080/socket_back
http://&lt;app dns&gt;/admin_front  =&gt; http://OPENSHIFT_CUSTOMCART_HTTP_IP:9000/admin_back</pre>
</div>
</div>

</div>
</div>

</div>
</div>
<div class="sect1">
<h2 id="cartridge-scripts"><a class="anchor" href="#cartridge-scripts"></a>7. Cartridge Scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How you implement the cartridge scripts in the <code>bin</code> directory is up to you as the author. For easily configured software where your cartridge is just installing one version, these scripts may include all the necessary code. For complex configurations or multi-version support, you may choose to write these scripts as shim code to setup the necessary environment before calling additional scripts you write. Or, you may choose to create symlinks from these names to a name of your choosing. Your API is the scripts and their associated actions.</p>
</div>
<div class="sect2">
<h3 id="notes-on-script-execution"><a class="anchor" href="#notes-on-script-execution"></a>7.1. Notes on Script Execution</h3>
<div class="paragraph">
<p>The scripts will be run directly from the home directory of the cartridge. They need to have the executable bit turned on, and they should have UNIX-friendly line endings (<code>\n</code>), not DOS ones (<code>\r\n</code>).</p>
</div>
<div class="paragraph">
<p>To ensure this, consider setting the following <code>git</code> options (just once) so that the files have correct line endings in the git repository:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>git config --global core.autocrlf input # use `true` on Windows
git config --global core.safecrlf true</pre>
</div>
</div>
<div class="paragraph">
<p>To ensure that the excutable bit is on, on UNIX-like systems, run:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>chmod +x bin/*</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

On Windows, you can achieve this by running <code>git update-index --chmod=+x bin/*</code> in the cartridge directory.
</td>
</tr>
</table>
</div>

</div>
<div class="sect2">
<h3 id="mandatory-scripts"><a class="anchor" href="#mandatory-scripts"></a>7.2. Mandatory Scripts</h3>
<div class="paragraph">
<p>A cartridge must implement the following scripts:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Script Name</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">setup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prepare this instance of cartridge to be operational for the initial install and each upgrade</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command cartridge to report or change state</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="optional-scripts"><a class="anchor" href="#optional-scripts"></a>7.3. Optional Scripts</h3>
<div class="paragraph">
<p>A cartridge may implement the following scripts:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Script Name</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">teardown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prepare this instance of cartridge to be removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prepare this instance of cartridge to be operational for the initial install</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An opportunity for configuration after the cartridge has been started for the initial install</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="exit-status-codes"><a class="anchor" href="#exit-status-codes"></a>7.4. Exit Status Codes</h3>
<div class="paragraph">
<p>OpenShift follows the convention that your scripts should return zero for success and non-zero for failure. Additionally, OpenShift supports special handling of the following non-zero exit codes:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Exit Code</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TODO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">131</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TODO</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These exit status codes will allow OpenShift to refine its behavior when returning HTTP status codes for the REST API, whether an internal operation can continue or should aborted, etc. Should your script return a value not included in this table, OpenShift will assume the problem is fatal to your cartridge.</p>
</div>

</div>
<div class="sect2">
<h3 id="erb-processing"><a class="anchor" href="#erb-processing"></a>7.5. ERB Processing</h3>
<div class="paragraph">
<p>In order to provide flexible configuration and environment variables, you may provide some values as <a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/erb/rdoc/ERB.html">ERB templates</a>.</p>
</div>
<div class="paragraph">
<p>Your templates will be rendered at <a href="http://www.ruby-doc.org/docs/ProgrammingRuby/html/taint.html)">http://www.ruby-doc.org/docs/ProgrammingRuby/html/taint.html)</a>.[<code>safe_level 2</code>] and are processed in 2 passes.</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>The first pass processes any entries in your <code>env</code> directory. This pass happens before <code>bin/setup</code> is called and is mandatory.</p>
</li>
<li>
<p>The second pass processes any entries specified in the <code>process_templates</code> entry of <code>metadata/managed_files.yml</code>. This pass happens after <code>bin/setup</code> but before <code>bin/install</code>. This allows <code>bin/setup</code> to create or modify ERB templates if needed. It also allows for <code>bin/install</code> to use these values or processed files.</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 3. ERB Examples</div>
<div class="content">
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Given <code>env/OPENSHIFT_MONGODB_DB_LOG_DIR.erb</code> containing:</p>
</li>
</ol>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>erb   &lt;% ENV['OPENSHIFT_HOMEDIR'] + "/mongodb/log/" %&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>becomes <code>env/OPENSHIFT_MONGODB_DB_LOG_DIR</code> containing:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>/var/lib/openshift/aa9e0f66e6451791f86904eef0939e/mongodb/log/</pre>
</div>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Given <code>conf/php.ini.erb</code> containing:</p>
</li>
</ol>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>erb   upload_tmp_dir = "&lt;%= ENV['OPENSHIFT_HOMEDIR'] %&gt;php/tmp/"   session.save_path = "&lt;%= ENV['OPENSHIFT_HOMEDIR'] %&gt;php/sessions/"</pre>
</div>
</div>
<div class="paragraph">
<p>becomes <code>conf/php.ini</code> containing:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>upload_tmp_dir = "/var/lib/openshift/aa9e0f66e6451791f86904eef0939e/php/tmp/"   session.save_path = "/var/lib/openshift/aa9e0f66e6451791f86904eef0939e/php/sessions/"</pre>
</div>
</div>

</div>
</div>
<div class="paragraph">
<p>Other candidates for templates are httpd configuration files for
<code>includes</code>, configuring databases to store persistent data in
<code>OPENSHIFT_DATA_DIR</code>, and setting the application name in the <code>pom.xml</code>
file.</p>
</div>

</div>
<div class="sect2">
<h3 id="bin-setup"><a class="anchor" href="#bin-setup"></a>7.6. bin/setup</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p><code>setup [--version &lt;version&gt;]</code></p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p><code>--version &lt;version&gt;</code>: Selects which version of cartridge to install. If no version is provided, the version denoted by the <code>Version</code> element from <code>manifest.yml</code> will be installed.</p>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p>The <code>setup</code> script is responsible for creating and/or configuring the files that were copied from the cartridge repository into the gear&#8217;s directory. Setup must also be reentrant and will be called on every non-backward compatible upgrade. Any logic you want to occur only once should be added to <code>install</code>.<br></p>
<div class="paragraph">
<p>Any files created during <code>setup</code> should be added to <code>setup_rewritten</code> section of <code>metadata/managed_files.yml</code>. These files will be deleted prior to <code>setup</code> being run during upgrades.<br></p>
</div>
<div class="paragraph">
<p>If you have used ERB templates for software configuration those files will be processed for environment variable substitution after <code>setup</code> is run.</p>
</div>

</dd>
<dt class="hdlist1">Lock Context</dt>
<dd>
<p><code>unlocked</code></p>
</dd>
</dl>
</div>

</div>
<div class="sect2">
<h3 id="bin-install"><a class="anchor" href="#bin-install"></a>7.7. bin/install</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p><code>install [--version &lt;version&gt;]</code></p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p><code>--version &lt;version&gt;</code>: Selects which version of cartridge to install. If no version is provided, the version denoted by the <code>Version</code> element from <code>manifest.yml</code> will be installed.</p>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p>The <code>install</code> script is responsible for creating and/or configuring the files that were copied from the cartridge repository into the gear&#8217;s directory. <code>install</code> will only be called on the initial install of a cartridge.</p>
<div class="ulist">

<ul>
<li>
<p>Any one-time operations, such as generating passwords, creating ssh keys, or adding environment variables, should occur in <code>install</code>.<br></p>
</li>
<li>
<p>Additionally, any client results/messages should also be reported in <code>install</code> rather than <code>setup</code>.<br></p>
</li>
<li>
<p><code>install</code> may substitute a version dependent of the <code>template</code> or <code>template.git</code> directories.</p>
</li>
</ul>
</div>

</dd>
<dt class="hdlist1">Lock Context</dt>
<dd>
<p><code>unlocked</code></p>
</dd>
</dl>
</div>

</div>
<div class="sect2">
<h3 id="bin-post-install"><a class="anchor" href="#bin-post-install"></a>7.8. bin/post-install</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p><code>post-install [--version &lt;version&gt;]</code></p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p><code>--version &lt;version&gt;</code>: Selects which version of cartridge to install. If no version is provided, the version denoted by the <code>Version</code> element from <code>manifest.yml</code> will be installed.</p>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p>The <code>post-install</code> script is an opportunity to configure your cartridge after the cartridge has been started and is only called for the initial install of the cartridge.</p>
</dd>
<dt class="hdlist1">Lock Context</dt>
<dd>
<p><code>locked</code></p>
</dd>
</dl>
</div>

</div>
<div class="sect2">
<h3 id="bin-teardown"><a class="anchor" href="#bin-teardown"></a>7.9. bin/teardown</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p><code>teardown</code></p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p><em>None</em></p>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p>The <code>teardown</code> script prepares the gear for the cartridge to be removed. This script will not called when the gear is destroyed. The <code>teardown</code> script is only run when a cartridge is to be removed from the gear. The gear is expected to continue to operate minus the functionality of your cartridge cartridge.</p>
</dd>
<dt class="hdlist1">Lock Context</dt>
<dd>
<p><code>unlocked</code></p>
</dd>
</dl>
</div>

</div>
<div class="sect2">
<h3 id="bin-control"><a class="anchor" href="#bin-control"></a>7.10. bin/control</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Synopsis</dt>
<dd>
<p><code>control &lt;action&gt;</code></p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p><code>action</code>: which operation the cartridge should perform.</p>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p>The <code>control</code> script allows OpenShift or user to control the state of the cartridge.</p>
</dd>
<dt class="hdlist1">Lock Context</dt>
<dd>
<p><code>locked</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here is the list of operations your cartridge may be called to perform:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-left valign-top">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">update-configuration, pre-build, build, deploy, or post-deploy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">described in the <a href="#openshift-builds">OpenShift Builds</a> section</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start the software your cartridge controls</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop the software your cartridge controls</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return an 0 exit status if your cartridge code is running</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your cartridge and the packaged software needs to re-read their configuration information (this operation will only be called if your cartridge is running)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">restart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop current process and start a new one for the code your cartridge packages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threaddump</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If applicable, your cartridge should signal the packaged software to perform a thread dump</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tidy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All unused resources should be released (it is at your discretion to determine what should be done; be frugal as on some systems resources may be very limited)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-snapshot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prepare the cartridge for a snapshot, e.g. dump database to flat file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-snapshot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clean up the cartridge after snapshot, e.g. remove database dump file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-restore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prepare the cartridge for restore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-restore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clean up the cartridge after being restored, load database with data from flat file</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="the-code-tidy-code-action"><a class="anchor" href="#the-code-tidy-code-action"></a>7.10.1. The <code>tidy</code> Action</h4>
<div class="paragraph">
<p>Some possible <code>tidy</code> behaviors:</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>rm $OPENSHIFT_{Cartridge-Short_Name}_DIR/logs/log.[0-9]</code></p>
</li>
<li>
<p><code>cd $OPENSHIFT_REPO_DIR ; mvn clean</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OpenShift has the following default <code>tidy</code> behaviors:</p>
</div>
<div class="ulist">

<ul>
<li>
<p>the Git repository will be garbage collected</p>
</li>
<li>
<p>all files will be removed from the <code>/tmp</code> directory</p>
</li>
</ul>
</div>

</div>
<div class="sect3">
<h4 id="the-code-status-code-action"><a class="anchor" href="#the-code-status-code-action"></a>7.10.2. The <code>status</code> Action</h4>
<div class="paragraph">
<p>For a number of reasons, the application developer will want to be able to query whether the software your cartridge packages is running and behaving as expected. A <code>0</code> exit status implies that the software is running correctly.</p>
</div>
<div class="paragraph">
<p>You may direct information to the application developer by writing to stdout. Errors may be return on stderr with a non-zero exit status.</p>
</div>
<div class="paragraph">
<p>OpenShift maintains the expected state of the gear/application in <code>~/app-root/runtime/.state</code>. You may not use this to determine the status of the software you are packaging. That software may have crashed so you would be returning an invalid status if you used this file&#8217;s value. Future versions of OpenShift may combine the results from the <code>status</code> action and the value of the <code>.state</code> file to automatically restart failed applications. For completeness, see the following <code>.state</code> values:</p>
</div>
<table class="tableblock frame-all grid-all" style="">
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">building</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application is currently being built</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploying</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application is currently being deployed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">idle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application has been shutdown because of no activity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">new</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gear has been created, but no application has been installed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">started</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application has been commanded to start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stopped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application has been commanded to stop</p></td>
</tr>
</tbody>
</table>

</div>

</div>
<div class="sect2">
<h3 id="messaging-to-openshift-from-cartridge"><a class="anchor" href="#messaging-to-openshift-from-cartridge"></a>7.11. Messaging to OpenShift from Cartridge</h3>
<div class="paragraph">
<p>Your cartridge may provide one or more services that are consumed by multiple gears in one application. OpenShift provides the orchestration necessary for you to publish this service or services. Each message is written to stdout, one message per line.</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>ENV_VAR_ADD: &lt;variable name&gt;=&lt;value&gt;</code></p>
</li>
<li>
<p><code>CART_DATA: &lt;variable name&gt;=&lt;value&gt;</code></p>
</li>
<li>
<p><code>CART_PROPERTIES: &lt;key&gt;=&lt;value&gt;</code></p>
</li>
<li>
<p><code>APP_INFO: &lt;value&gt;</code></p>
</li>
</ul>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="custom-http-services"><a class="anchor" href="#custom-http-services"></a>8. Custom HTTP Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your cartridge may expose services using the application&#8217;s URL by providing one or more snippets of Apache configuration code using ERB templates in the <code>httpd.d</code> directory. The <code>httpd.d</code> directory and its contents are optional. After OpenShift has run your <code>setup</code> script, it will render each ERB template and write the contents of the node&#8217;s httpd configuration.</p>
</div>
<div class="paragraph">
<p>An example of <code>mongodb.conf.erb</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>Alias /health &lt;%= ENV['OPENSHIFT_HOMEDIR'] + "/mongodb/httpd.d/health.html" %&gt;
Alias / &lt;%= ENV['OPENSHIFT_HOMEDIR'] + "/mongodb/httpd.d/index.html" %&gt;</pre>
</div>
</div>

</div>
</div>
<div class="sect1">
<h2 id="environment-variables"><a class="anchor" href="#environment-variables"></a>9. Environment Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Environment variables are used to communicate information between this cartridge and others, as well as to OpenShift. The cartridge controlled variables are stored in the <code>env</code> directory and will be loaded after system-provided environment variables but before your code is called. OpenShift-provided environment variables will be loaded and available to be used for all cartridge entry points.</p>
</div>
<div class="paragraph">
<p>You cannot override system provided variables by creating new copies in your cartridge <code>env</code> directory. If you attempt to do so, when an application developer attempts to instantiate your cartridge the system will raise an exception and refuse to do so.</p>
</div>
<div class="sect2">
<h3 id="system-provided-variables-read-only"><a class="anchor" href="#system-provided-variables-read-only"></a>9.1. System Provided Variables (Read Only)</h3>
<table class="tableblock frame-all grid-all" style="">
<colgroup>
<col>
<col> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HOME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias for <code>OPENSHIFT_HOMEDIR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HISTFILE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bash history file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_APP_DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The application&#8217;s fully qualified domain name that your cartridge is a part of</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_APP_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The validated user assigned name for the application (black list is system dependent)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_APP_UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift-assigned UUID for the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_DATA_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory where your cartridge may store data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_GEAR_DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The gear&#8217;s fully qualified domain name that your cartridge is a part of (may or may not be equal to <code>OPENSHIFT_APP_DNS</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_GEAR_NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift-assigned name for the gear (may or may not be equal to <code>OPENSHIFT_APP_NAME</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_GEAR_UUID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift-assigned UUID for the gear</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_HOMEDIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift-assigned directory for the gear</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_REPO_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory where the developer&#8217;s application is "archived" to and will be run from</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPENSHIFT_TMP_DIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory where your cartridge may store temporary data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMPDIR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias for <code>OPENSHIFT_TMP_DIR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias for <code>OPENSHIFT_TMP_DIR</code></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="system-provided-cartridge-variables-read-only"><a class="anchor" href="#system-provided-cartridge-variables-read-only"></a>9.2. System Provided Cartridge Variables (Read Only)</h3>
<div class="exampleblock">

<div class="content">
<div class="ulist">

<ul>
<li>
<p><code>OPENSHIFT_{Cartridge-Short-Name}_DIR</code></p>
</li>
<li>
<p><code>OPENSHIFT_{Cartridge-Short-Name}_IDENT</code></p>
</li>
<li>
<p><code>OPENSHIFT_PRIMARY_CARTRIDGE_DIR</code></p>
</li>
</ul>
</div>

</div>
</div>
<div class="sect3">
<h4 id="examples-of-cartridge-variables"><a class="anchor" href="#examples-of-cartridge-variables"></a>9.2.1. Examples of Cartridge Variables</h4>
<div class="paragraph">
<p>These are variables provided to you for communicating to the application developer. You may add additional variables for your cartridge&#8217;s or the packaged software&#8217;s needs. You may provide these files in your cartridge&#8217;s <code>env</code> directory or choose to create them in your <code>setup</code> and <code>install</code> scripts.</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>OPENSHIFT_MYSQL_DB_HOST</code> Backwards compatibility (ERB populate from <code>OPENSHIFT_MYSQL_DB_IP</code>)</p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_IP</code></p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_LOG_DIR</code></p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_PASSWORD</code></p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_PORT</code></p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_SOCKET</code></p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_URL</code></p>
</li>
<li>
<p><code>OPENSHIFT_MYSQL_DB_USERNAME</code></p>
</li>
<li>
<p><code>OPENSHIFT_PHP_LOG_DIR</code></p>
</li>
<li>
<p><code>OPENSHIFT_PHP_DIR</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some variables may be dictated by the software you are packaging:</p>
</div>
<div class="ulist">

<ul>
<li>
<p><code>JENKINS_URL</code></p>
</li>
<li>
<p><code>JENKINS_USERNAME</code></p>
</li>
<li>
<p><code>JENKINS_PASSWORD</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your environment variables should be prefixed with <code>OPENSHIFT_{cartridge short name}_</code> to prevent overwriting other cartridge variables in the packaged software&#8217;s process environment space.</p>
</div>
<div class="paragraph">
<p>By convention, an environment variable whose value is a directory should have a name that ends in <code>_DIR</code> and the value should have a trailing slash. The software you are packaging may have environment variable requirements of its own, for example: <code>JENKINS_URL</code>; these would be added to your <code>env</code> directory or included in shim code in your <code>bin</code> scripts.</p>
</div>
<div class="paragraph">
<p>Cartridge-provided environment variables are not validated by the system. Your cartridge may fail to function if you write invalid data to these files.</p>
</div>
<div class="paragraph">
<p>You may provide ERB templates in the <code>env</code> directory (see above for details). ERB templates in the <code>env</code> directory will be processed before <code>setup</code> is called.</p>
</div>
<div class="paragraph">
<p>The <code>PATH</code> variable is set by OpenShift with the base being <code>/etc/openshift/env/PATH</code>. If you provide an <code>OPENSHIFT_{Cartridge-Short-Name}_PATH_ELEMENT</code>, OpenShift will include the value when building the <code>PATH</code> when your scripts are run or an application developer does an interactive log on.</p>
</div>

</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="cartridge-events"><a class="anchor" href="#cartridge-events"></a>10. Cartridge Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cartridges may need to act when another cartridge is added or removed from an application. OpenShift supports a simple publish/subscribe system which allows cartridges to communicate in the context of these events.</p>
</div>
<div class="paragraph">
<p>The <code>Publishes</code> and <code>Subscribes</code> sections of the cartridge <code>manifest.yml</code> are used to express the event support for a given cartridge.</p>
</div>
<div class="sect2">
<h3 id="cartridge-event-publishing"><a class="anchor" href="#cartridge-event-publishing"></a>10.1. Cartridge Event Publishing</h3>
<div class="paragraph">
<p>Publish events are defined via the <code>manifest.yml</code> for the cartridge, in
the following format:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Publishes</span>:   <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;event name&gt;:     Type: &quot;&lt;event type&gt;&quot;   ...</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When a cartridge is added to an application, each entry in the <code>Publishes</code> section of the manifest is used to construct events dispatched to other cartridges in the application. For each publish entry, OpenShift will attempt to execute a script named <code>hooks/&lt;event name&gt;</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>hooks/&lt;event name&gt; &lt;gear name&gt; &lt;namespace&gt; &lt;gear uuid&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>All lines of output (on stdout) produced by the script will be joined by single spaces and used as the input to matching subscriber scripts. All cartridges which declare a subscription whose <code>Type</code> matches that of the publish event will be notified.</p>
</div>

</div>
<div class="sect2">
<h3 id="cartridge-event-subscriptions"><a class="anchor" href="#cartridge-event-subscriptions"></a>10.2. Cartridge Event Subscriptions</h3>
<div class="paragraph">
<p>Subscriptions to events published by other carts are defined via the <code>manifest.yml</code> for the cartridge, in the following format:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Subscribes</span>:   <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">&lt;event name&gt;     Type: &quot;&lt;event type&gt;&quot;   ...</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When a cartridge publish event is fired, the subscription entries in the <code>Subscribes</code> section whose <code>Type</code> matches that of the publish event will be processed. For each matching subscription event, OpenShift will attempt to execute a script named <code>hooks/&lt;event name&gt;</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>hooks/&lt;event name&gt; &lt;gear name&gt; &lt;namespace&gt; &lt;gear uuid&gt; &lt;publish output&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The format of the <code>&lt;publish output&gt;</code> input to the subscription script is defined by the implementation of the publisher script, and so the cartridge subscription script must have an awareness of the output format of the matching publish script.</p>
</div>

</div>
<div class="sect2">
<h3 id="cartridge-event-example"><a class="anchor" href="#cartridge-event-example"></a>10.3. Cartridge Event Example</h3>
<div class="paragraph">
<p>Consider a simple example of a PHP cartridge which can react when MySQL is added to an application, so that it can set environment variables on the gear to be able to connect to the newly added MySQL cartridge on a different gear.</p>
</div>
<div class="paragraph">
<p>This requires a <code>Subscribes</code> section in the PHP cartridge <code>manifest.yml</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Subscribes</span>:   <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">set-mysql-connection-info:     Type: &quot;NET_TCP:db:mysql&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And a <code>Publishes</code> section in the MySQL cartridge <code>manifest.yml</code>:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre class="CodeRay"><code class="yaml language-yaml"><span style="color:#606">Publishes</span>:   <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">publish-mysql-connection-info:     Type: &quot;NET_TCP:db:mysql&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The PHP cartridge implements a script in <code>hooks/set-mysql-connection-info</code>, and the MySQL cartridge implements a script in <code>hooks/publish-mysql-connection-info</code>.</p>
</div>
<div class="paragraph">
<p>These events and scripts are matched on the basis of the string value in <code>Type</code> (<code>"NET_TCP:db:mysql"</code>).</p>
</div>
<div class="paragraph">
<p>The <code>publish-mysql-connection-info</code> script could output the host, port, and password to connect to the MySQL instance, and it will be fed as input to the <code>set-mysql-connection-info</code> script in the PHP cart when MySQL is added to an application that has PHP installed.</p>
</div>
<div class="paragraph">
<p>For example, consider the following output from the <code>publish-mysql-connection-info</code> in the MySQL cartridge:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>OPENSHIFT_MYSQL_DB_USERNAME=username;
OPENSHIFT_MYSQL_DB_PASSWORD=password;
OPENSHIFT_MYSQL_DB_HOST=hostname;
OPENSHIFT_MYSQL_DB_PORT=port;
OPENSHIFT_MYSQL_DB_URL=url;</pre>
</div>
</div>
<div class="paragraph">
<p>This would be fed as input to <code>hooks/publish-mysql-connection-info</code> in the PHP cartridge, as follows:</p>
</div>
<div class="listingblock">

<div class="content monospaced">
<pre>hooks/publish-mysql-connection-info gear_name namespace gear_uuid 'OPENSHIFT_MYSQL_DB_USERNAME=username;OPENSHIFT_MYSQL_DB_PASSWORD=password;OPENSHIFT_MYSQL_DB_HOST=hostname;OPENSHIFT_MYSQL_DB_PORT=port;OPENSHIFT_MYSQL_DB_URL=url;'</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>publish-mysql-connection-info</code> is responsible for being capable of parsing the final argument and extracting the values provided.</p>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="backing-up-and-restoring-your-cartridge"><a class="anchor" href="#backing-up-and-restoring-your-cartridge"></a>11. Backing Up and Restoring Your Cartridge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift provides a snapshot/restore feature for user applications. This feature is meant to allow OpenShift application developers to:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>Capture the state (<em>snapshot</em>) of their application and produce an archive of that state.</p>
</li>
<li>
<p>Use a previously taken snapshot of an application to restore the application to the state in the snapshot.</p>
</li>
<li>
<p>Use a previously taken snapshot of an application to restore a new application to the state in the snapshot. This could be merely renaming an application or copying an application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>OpenShift uses the <code>tar</code> command when backing up and restoring the gear that contains your cartridge. The file <code>metadata/managed_files.yml</code> <code>snapshot_exclusions</code> entry contains an array of patterns of files that will not be backed up or restored. If you exclude files from being backed up and restored you need to ensure those files are not required for your cartridge&#8217;s operation.</p>
</div>
<div class="paragraph">
<p>The file <code>metadata/managed_files.yml</code> <code>restore_transforms</code> entry contains scripts that will be used to transform file names during restore.</p>
</div>
<div class="paragraph">
<p>Both entries are optional and may be omitted. Empty files will be ignored. Patterns are from the <code>OPENSHIFT_HOMEDIR</code> directory rather than your cartridge&#8217;s directory. See the man page for <code>tar</code> (the <code>--transform</code> and <code>--exclude-from</code> options) for more details.</p>
</div>
<div class="sect2">
<h3 id="understanding-openshift-behavior-snapshot"><a class="anchor" href="#understanding-openshift-behavior-snapshot"></a>11.1. Understanding OpenShift Behavior: Snapshot</h3>
<div class="paragraph">
<p>OpenShift creates an archive during <code>snapshot</code> as follows:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>OpenShift stops the application by invoking <code>gear stop</code>.</p>
</li>
<li>
<p>OpenShift invokes <code>control pre-snapshot</code> for each installed cartridge in the gear. Cartridges may control their serialization in the snapshot by implementing this control action in conjunction with exclusions (example: cartridge authors want to snapshot/restore to/from a database dump instead of a database file).</p>
</li>
<li>
<p>OpenShift builds a list of exclusions by reading the <code>snapshot_exclusions</code> list from the <code>metadata/managed_files.yml</code> file for each cartridge in the gear.</p>
</li>
<li>
<p>OpenShift creates an archive in tar.gz format and writes it to STDOUT for consumption by the client tools. The following exclusions are used in addition to the list created from cartridges:</p>
</li>
<li>
<p>Gear user <code>.tmp</code>, <code>.ssh</code>, <code>.sandbox</code></p>
</li>
<li>
<p>Application state file (<code>app-root/runtime/.state</code>)</p>
</li>
<li>
<p>Bash history file (<code>$OPENSHIFT_DATA_DIR/.bash_history</code>)</p>
</li>
<li>
<p>OpenShift invokes <code>control post-snapshot</code> for each installed cartridge in the gear.</p>
</li>
<li>
<p>OpenShift starts the application by invoking <code>gear start</code>.</p>
</li>
</ol>
</div>

</div>
<div class="sect2">
<h3 id="understanding-openshift-behavior-restore"><a class="anchor" href="#understanding-openshift-behavior-restore"></a>11.2. Understanding OpenShift Behavior: Restore</h3>
<div class="paragraph">
<p>OpenShift restores an application from an archive as follows:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>OpenShift prepares the application for restoration.</p>
</li>
<li>
<p>If the archive contains a git repo, the platform invokes <code>gear prereceive</code>.</p>
</li>
<li>
<p>Otherwise, the platform invokes <code>gear stop</code>.</p>
</li>
<li>
<p>OpenShift invokes <code>control pre-restore</code> for each installed cartridge in the gear. This allows cartridges that control their snapshotted state to prepare their cartridges for restoration (example: delete old database dump, if present).</p>
</li>
<li>
<p>OpenShift builds a list of transforms to apply by reading the <code>restore_transforms</code> entries from the <code>metadata/managed_files.yml</code> file of each cartridge installed in the gear.</p>
</li>
<li>
<p>OpenShift extracts the archive into the gear user&#8217;s home directory, overwriting existing files, and applying the transformations obtained from cartridges.</p>
</li>
<li>
<p>OpenShift invokes <code>control post-restore</code> for each installed cartridge in the gear (example: delete new database dump that the db was restored from).</p>
</li>
<li>
<p>OpenShift resumes the application.</p>
</li>
<li>
<p>If the archive contains a git repo, OpenShift invokes <code>gear postreceive</code>.</p>
</li>
<li>
<p>Otherwise, OpenShift invokes <code>gear start</code> .</p>
</li>
</ol>
</div>

</div>

</div>
</div>
<div class="sect1">
<h2 id="sample-conf-d-openshift-conf-erb"><a class="anchor" href="#sample-conf-d-openshift-conf-erb"></a>12. Sample conf.d/openshift.conf.erb</h2>
<div class="sectionbody">
<div class="listingblock">

<div class="content monospaced">
<pre>ServerRoot "&lt;%= ENV['OPENSHIFT_HOMEDIR'] + "/ruby-1.8" %&gt;"
DocumentRoot "&lt;%= ENV['OPENSHIFT_REPO_DIR'] + "/public" %&gt;"
Listen &lt;%= ENV['OPENSHIFT_RUBY_IP'] + ':' + ENV['OPENSHIFT_RUBY_PORT'] %&gt;
User &lt;%= ENV['OPENSHIFT_GEAR_UUID'] %&gt;
Group &lt;%= ENV['OPENSHIFT_GEAR_UUID'] %&gt;

ErrorLog "|/usr/sbin/rotatelogs &lt;%= ENV['OPENSHIFT_HOMEDIR']%&gt;/ruby-1.8/logs/error_log-%Y%m%d-%H%M%S-%Z 86400"
CustomLog "|/usr/sbin/rotatelogs &lt;%= ENV['OPENSHIFT_HOMEDIR']%&gt;/logs/access_log-%Y%m%d-%H%M%S-%Z 86400" combined

PassengerUser &lt;%= ENV['OPENSHIFT_GEAR_UUID'] %&gt;
PassengerPreStart http://&lt;%= ENV['OPENSHIFT_RUBY_IP'] + ':' + ENV['OPENSHIFT_RUBY_PORT'] %&gt;/
PassengerSpawnIPAddress &lt;%= ENV['OPENSHIFT_RUBY_IP'] %&gt;
PassengerUseGlobalQueue off
&lt;Directory &lt;%= ENV['OPENSHIFT_REPO_DIR]%&gt;/public&gt;
  AllowOverride all
  Options -MultiViews
&lt;/Directory&gt;</pre>
</div>
</div>

</div>
</div>
<div class="sect1">
<h2 id="openshift-builds"><a class="anchor" href="#openshift-builds"></a>13. OpenShift Builds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When changes are pushed to an application&#8217;s Git repository, OpenShift will build and deploy the application using the updated changes from the repository. The specific build lifecycle which manages the build process changes depending on the presence of a builder cartridge within the application.</p>
</div>
<div class="sect2">
<h3 id="default-build-lifecycle"><a class="anchor" href="#default-build-lifecycle"></a>13.1. Default Build Lifecycle</h3>
<div class="paragraph">
<p>When no builder cartridge has been added to the application, changes pushed to the application Git repository result in the execution of the default build lifecycle. The default lifecycle consists of a <code>build</code> and <code>deploy</code> phase, each of which aggregates several steps.</p>
</div>
<div class="paragraph">
<p>In this lifecycle, OpenShift manages the start and stop of the application, as well as moves the newly committed code into <code>$OPENSHIFT_REPO_DIR</code>. All other specific behaviors are defined by the primary cartridge as well as any user action hooks present.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">

User action hooks are assumed to reside in <code>$OPENSHIFT_REPO_DIR/.openshift/action_hooks</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During the <code>build</code> phase:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>The application is stopped.</p>
</li>
<li>
<p>The primary cartridge <code>pre-receive</code> control action is executed.</p>
</li>
<li>
<p>The primary cartridge <code>pre-repo-archive</code> control action is executed.</p>
</li>
<li>
<p>The newly committed application source code is copied to <code>$OPENSHIFT_REPO_DIR</code>. <em>This step is the only time the application source code is copied by OpenShift during this lifecycle.</em></p>
</li>
<li>
<p>The primary cartridge <code>update-configuration</code> control action is executed.</p>
</li>
<li>
<p>The primary cartridge <code>pre-build</code> control action is executed.</p>
</li>
<li>
<p>The <code>pre-build</code> user action hook is executed, if present.</p>
</li>
<li>
<p>The primary cartridge <code>build</code> control action is executed.</p>
</li>
<li>
<p>The <code>build</code> user action hook is executed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Next, during the <code>deploy</code> phase:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>All secondary cartridges in the application are started.</p>
</li>
<li>
<p>The primary cartridge <code>deploy</code> control action is executed.</p>
</li>
<li>
<p>The <code>deploy</code> user action hook is executed, if present.</p>
</li>
<li>
<p>The primary cartridge is started (the application is now fully started).</p>
</li>
<li>
<p>The primary cartridge <code>post-deploy</code> control action is executed.</p>
</li>
<li>
<p>The <code>post-deploy</code> user action hook is executed, if present.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point, the application has been fully built and restarted.</p>
</div>

</div>
<div class="sect2">
<h3 id="default-scaling-build-lifecycle"><a class="anchor" href="#default-scaling-build-lifecycle"></a>13.2. Default Scaling Build Lifecycle</h3>
<div class="paragraph">
<p>A scalable application build proceeds exactly the same way as a regular application during the <code>build</code> phase on the head gear (i.e. the primary gear on which the web_proxy runs).</p>
</div>
<div class="paragraph">
<p>The difference in behavior comes during the <code>deploy</code> phase:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>All secondary cartridges in the application are started on the head gear.</p>
</li>
<li>
<p>The web_proxy cartridge <code>deploy</code> hook is executed on the head gear; it is responsible for distributing the code/build artifacts to the other gears and run the <code>deploy</code> steps on them as well.</p>
</li>
<li>
<p>The following steps are executed by the default web_proxy, i.e. haproxy:</p>
<div class="olist loweralpha">

<ol class="loweralpha" type="a">
<li>
<p>The secondary gears are stopped.</p>
</li>
<li>
<p>The code/build artifacts from the head gear are synced to secondary gears.</p>
</li>
<li>
<p>The primary cartridge <code>update-configuration</code> control action is called on secondary gears.</p>
</li>
<li>
<p>All secondary cartridges in the application are started on secondary gears.</p>
</li>
<li>
<p>The primary cartridge <code>deploy</code> control action is executed on secondary gears.</p>
</li>
<li>
<p>The <code>deploy</code> user action hook is executed, if present, on secondary gears.</p>
</li>
<li>
<p>The primary cartridge is started (the application is now fully started) on secondary gears.</p>
</li>
<li>
<p>The primary cartridge <code>post-deploy</code> control action is executed on secondary gears.</p>
</li>
<li>
<p>The <code>post-deploy</code> user action hook is executed, if present, on secondary gears.</p>
</li>
</ol>
</div>

</li>
<li>
<p>The primary cartridge <code>deploy</code> control action is executed on the head gear.</p>
</li>
<li>
<p>The <code>deploy</code> user action hook is executed, if present, on the head gear.</p>
</li>
<li>
<p>The primary cartridge is started (the application is now fully started) on the head gear.</p>
</li>
<li>
<p>The primary cartridge <code>post-deploy</code> control action is executed on the head gear.</p>
</li>
<li>
<p>The <code>post-deploy</code> user action hook is executed, if present, on the head gear.</p>
</li>
</ol>
</div>

</div>
<div class="sect2">
<h3 id="builder-cartridge-lifecycle"><a class="anchor" href="#builder-cartridge-lifecycle"></a>13.3. Builder Cartridge Lifecycle</h3>
<div class="paragraph">
<p>If a builder cartridge is present in the application, changes pushed to the application Git repository will execute using an alternate build lifecycle which hands over operations to the builder cartridge. In this lifecycle, OpenShift provides no specific behavior for the build beyond giving the builder cartridge the opportunity to perform work. The sequence of events follows:</p>
</div>
<div class="paragraph">
<p>During the Git <code>pre-receive</code> hook:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>The builder cartridge <code>pre-receive</code> control action is executed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>During the Git <code>post-receive</code> hook:</p>
</div>
<div class="olist arabic">

<ol class="arabic">
<li>
<p>The builder cartridge <code>post-receive</code> control action is executed.</p>
</li>
</ol>
</div>

</div>
<div class="sect2">
<h3 id="builder-tips"><a class="anchor" href="#builder-tips"></a>13.4. Builder Tips</h3>
<div class="paragraph">
<p>Any build implementation should take care to avoid duplicating source or copying artifacts any more than necessary. The space a cartridge&#8217;s build implementation consumes during the build cycle is the application developer&#8217;s, and so cartridge authors should take care to be as conservative as possible.</p>
</div>

</div>

</div>
</div></div>
<div id="footer">
<div id="footer-text">
 2.0
</div>
<!-- Google Analytics -->
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40375612-1']);
  _gaq.push(['_setDomainName', 'openshift.github.io']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  
  $(document).ready(function() {
    _gaq.push(function() {
      $('a:not([href^="http"])').on("click", function(e) {
        e.preventDefault();
        var link = $(this).attr("href");
        _gaq.push(["_trackEvent", "Internal Links", "click", link]);
        setTimeout('document.location = "' + link + '"', 300);
      });
      $('a[href^="http"]').on("click", function(e) {
        e.preventDefault();
        var link = $(this).attr("href");
        _gaq.push(["_trackEvent", "Outbound Links", "click", link]);
        setTimeout('document.location = "' + link + '"', 300);
      });
    });
  });
</script>
<!-- Google Code for Remarketing -->
<script>
  var google_conversion_id = 1007064360;
  var google_conversion_label = "7jfmCMC5ugQQqKqa4AM";
  var google_custom_params = window.google_tag_params;
  var google_remarketing_only = true;
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
<div style="display: inline;">
<img alt="" height="1" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1007064360/?value=0&amp;label=7jfmCMC5ugQQqKqa4AM&amp;guid=ON&amp;script=0" style="border-style: none;" width="1">
</div>
</noscript>
</div>
</body>
</html>